<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>ìˆ¨ì€ ì‚¬ì§„ ìŠ¤íŒŸ - í¬í† ìŠ¤íŒŸ ì»¤ë®¤ë‹ˆí‹°</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary: #ff6b6b;
      --secondary: #4ecdc4;
      --accent: #ffe66d;
      --dark: #2d3436;
      --light: #f8f9fa;
      --border: #e9ecef;
      --shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif;
      background: linear-gradient(135deg, #fffaf0 0%, #fff8e7 100%);
      min-height: 100vh;
      color: var(--dark);
    }

    header {
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      color: #5a4a3a;
      padding: 20px;
      box-shadow: var(--shadow);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    header h1 {
      font-size: 28px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    header p {
      opacity: 0.9;
      font-size: 14px;
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 14px;
    }

    .user-info button {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-login {
      background: white;
      color: #5a4a3a;
    }

    .btn-logout {
      background: #e74c3c;
      color: white;
    }

    .btn-login:hover, .btn-logout:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 15px;
    }

    .nav-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      background: white;
      padding: 15px;
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    .nav-tabs button {
      padding: 12px 24px;
      border: none;
      background: var(--light);
      color: var(--dark);
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .nav-tabs button:hover,
    .nav-tabs button.active {
      background: var(--primary);
      color: white;
      transform: translateY(-2px);
    }

    .search-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      background: white;
      padding: 15px;
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    .search-bar input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .search-bar input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
    }

    .search-bar select {
      padding: 12px 16px;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: white;
      cursor: pointer;
      font-size: 14px;
    }

    .view {
      display: none;
      animation: fadeIn 0.3s ease-in;
    }

    .view.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .list-view {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .spot-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: all 0.3s;
      cursor: pointer;
    }

    .spot-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }

    .spot-card-image {
      width: 100%;
      height: 240px;
      object-fit: contain;
      background: #f8f9fa;
      border-bottom: 1px solid var(--border);
    }

    .spot-card-content {
      padding: 16px;
    }

    .spot-card-title {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--dark);
    }

    .spot-card-desc {
      font-size: 13px;
      color: #666;
      margin-bottom: 12px;
      line-height: 1.4;
    }

    .spot-card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
    }

    .tag {
      display: inline-block;
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      color: #5a4a3a;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
    }

    .spot-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 12px;
      border-top: 1px solid var(--border);
      font-size: 12px;
      color: #999;
    }

    .spot-card-stats {
      display: flex;
      gap: 12px;
    }

    .detail-view {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    .detail-header {
      position: relative;
      height: 300px;
      overflow: hidden;
    }

    .detail-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .detail-back-btn {
      position: absolute;
      top: 16px;
      left: 16px;
      background: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: var(--shadow);
      z-index: 10;
    }

    .detail-back-btn:hover {
      background: #f0f0f0;
    }

    .detail-body {
      padding: 24px;
    }

    .detail-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .detail-location {
      color: var(--primary);
      font-size: 13px;
      margin-bottom: 12px;
      display: none;
    }

    .detail-desc {
      color: #666;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 16px;
    }

    .detail-actions {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .map-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .map-modal.active {
      display: flex;
    }

    .map-modal-content {
      background: white;
      border-radius: 12px;
      max-width: 800px;
      max-height: 90vh;
      overflow: auto;
      position: relative;
    }

    .map-modal-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 1;
    }

    .map-modal-close:hover {
      background: #f0f0f0;
    }

    .map-modal img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 12px;
    }

    /* ë¡œê·¸ì¸/íšŒì›ê°€ì… ëª¨ë‹¬ */
    .auth-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .auth-modal.active {
      display: flex;
    }

    .auth-modal-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    .auth-modal h2 {
      margin-bottom: 20px;
      color: var(--dark);
    }

    .auth-form {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .auth-form input {
      padding: 12px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
    }

    .auth-form button {
      padding: 12px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .auth-form button:hover {
      background: #ff5252;
      transform: translateY(-2px);
    }

    .auth-form .cancel-btn {
      background: #999;
    }

    .auth-form .cancel-btn:hover {
      background: #777;
    }

    .auth-error {
      color: #e74c3c;
      font-size: 14px;
      margin-top: -10px;
      display: none;
    }

    .auth-error.active {
      display: block;
    }

    .detail-btn {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: all 0.3s;
    }

    .detail-btn-primary {
      background: var(--primary);
      color: white;
    }

    .detail-btn-primary:hover {
      background: #ff5252;
      transform: scale(1.05);
    }

    .detail-btn-secondary {
      background: var(--light);
      color: var(--dark);
      border: 2px solid var(--border);
    }

    .detail-btn-secondary:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .detail-btn-danger {
      background: #fff;
      color: #f44336;
      border: 2px solid #f44336;
    }

    .detail-btn-danger:hover {
      background: #f44336;
      color: white;
    }

    /* ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ ìŠ¤íƒ€ì¼ */
    .photo-gallery {
      position: relative;
      width: 100%;
      height: 400px;
      background: #f5f5f5;
      border-radius: 12px;
      overflow: hidden;
      margin: 20px 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .gallery-container {
      display: flex;
      height: 100%;
      transition: transform 0.3s ease-out;
      touch-action: pan-y;
    }

    .gallery-slide {
      min-width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }

    .gallery-slide img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .gallery-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.9);
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: all 0.2s;
    }

    .gallery-nav:hover {
      background: rgba(255,255,255,1);
      transform: translateY(-50%) scale(1.1);
    }

    .gallery-nav.prev {
      left: 10px;
    }

    .gallery-nav.next {
      right: 10px;
    }

    .gallery-indicators {
      position: absolute;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: 10;
    }

    .gallery-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.5);
      cursor: pointer;
      transition: all 0.3s;
    }

    .gallery-indicator.active {
      background: rgba(255,255,255,1);
      width: 24px;
      border-radius: 4px;
    }

    .gallery-counter {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 14px;
      z-index: 10;
    }

    .gallery-delete-btn {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(244, 67, 54, 0.9);
      color: white;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: all 0.2s;
    }

    .gallery-delete-btn:hover {
      background: rgba(244, 67, 54, 1);
      transform: scale(1.1);
    }

    .map-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .map-section h3 {
      margin-bottom: 12px;
      font-size: 16px;
    }

    #detailMap {
      width: 100%;
      height: 400px;
      border-radius: 8px;
      overflow: hidden;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #detailMap img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      cursor: pointer;
    }

    .map-placeholder {
      color: #999;
      text-align: center;
      padding: 20px;
    }

    .nearby-section {
      margin: 24px 0;
      padding: 20px;
      background: #fff9f0;
      border-radius: 12px;
      border: 2px solid #ffe4b5;
    }

    .nearby-section h3 {
      margin-bottom: 16px;
      font-size: 18px;
      color: #5a4a3a;
    }

    .accommodations-list {
      display: grid;
      gap: 12px;
    }

    .accommodation-item {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #e9ecef;
      transition: all 0.3s;
      cursor: pointer;
    }

    .accommodation-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .accommodation-name {
      font-weight: 600;
      font-size: 15px;
      color: #2d3436;
      margin-bottom: 6px;
    }

    .accommodation-category {
      display: inline-block;
      padding: 3px 8px;
      background: #4ecdc4;
      color: white;
      border-radius: 4px;
      font-size: 11px;
      margin-bottom: 6px;
    }

    .accommodation-address {
      font-size: 12px;
      color: #666;
      margin-bottom: 6px;
    }

    .accommodation-distance {
      font-size: 12px;
      color: #888;
      margin-bottom: 8px;
    }

    .accommodation-phone {
      font-size: 12px;
      color: #4ecdc4;
    }

    .show-more-btn {
      width: 100%;
      padding: 12px;
      margin-top: 12px;
      background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
      color: #5a4a3a;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .show-more-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .show-more-btn.expanded {
      background: linear-gradient(135deg, #dfe6e9 0%, #b2bec3 100%);
    }

    .show-more-btn.expanded i {
      transform: rotate(180deg);
    }

    .comments-section {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }

    .comments-section h3 {
      margin-bottom: 16px;
      font-size: 16px;
    }

    .comment-form {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }

    .comment-form input {
      flex: 1;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 13px;
    }

    .comment-form button {
      padding: 10px 16px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 12px;
    }

    .comment-form button:hover {
      background: #ff5252;
    }

    .comment-item {
      background: var(--light);
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 10px;
    }

    .comment-author {
      font-weight: 600;
      color: var(--dark);
      font-size: 13px;
    }

    .comment-text {
      font-size: 13px;
      color: #666;
      margin-top: 4px;
    }

    .comment-date {
      font-size: 11px;
      color: #999;
      margin-top: 4px;
    }

    .comment-delete {
      background: #ffebee;
      color: var(--primary);
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      cursor: pointer;
      margin-top: 6px;
    }

    .engagement-bar {
      display: flex;
      gap: 16px;
      padding: 16px 0;
      border-bottom: 1px solid var(--border);
    }

    .engagement-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.3s;
      padding: 8px 12px;
      border-radius: 6px;
    }

    .engagement-btn:hover {
      background: var(--light);
      color: var(--primary);
    }

    .engagement-btn.liked {
      color: var(--primary);
      font-weight: 600;
    }

    .map-view {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
      height: 700px;
    }

    #mapContainer {
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .leaflet-popup-content {
      margin: 8px;
      min-width: 200px;
    }

    .popup-title {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 8px;
      color: var(--primary);
    }

    .popup-desc {
      font-size: 13px;
      color: #666;
      margin-bottom: 8px;
      line-height: 1.4;
    }

    .popup-tags {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }

    .popup-tag {
      background: #f0f0f0;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 11px;
      color: #666;
    }

    .popup-button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      width: 100%;
      margin-top: 4px;
    }

    .popup-button:hover {
      opacity: 0.9;
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    @media (max-width: 768px) {
      .list-view {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      }

      .detail-header {
        height: 220px;
      }

      header h1 {
        font-size: 22px;
      }

      .nav-tabs {
        flex-direction: column;
      }

      .nav-tabs button {
        width: 100%;
      }

      .detail-actions {
        flex-direction: column;
      }

      .detail-btn {
        justify-content: center;
      }

      #detailMap {
        height: 250px;
      }

      #mapContainer {
        height: 400px;
      }

      .search-bar {
        flex-direction: column;
      }

      .search-bar input,
      .search-bar select {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .list-view {
        grid-template-columns: 1fr;
      }

      header h1 {
        font-size: 18px;
      }

      .detail-body {
        padding: 16px;
      }

      .detail-title {
        font-size: 20px;
      }

      .spot-card-image {
        height: 150px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-top">
      <div>
        <h1>ğŸ“¸ ìˆ¨ì€ ì‚¬ì§„ ìŠ¤íŒŸ</h1>
      </div>
      <div style="display: flex; align-items: center; gap: 10px;">
        <div class="user-info" id="userInfo">
          <div style="display: flex; align-items: center; gap: 10px; font-size: 14px; color: #666;">
            <span>â³ ë¡œê·¸ì¸ ì¤‘...</span>
          </div>
        </div>
        <button onclick="showAdminLoginModal()" style="padding: 8px 16px; background: #f39c12; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">ğŸ‘‘ ê´€ë¦¬ì</button>
      </div>
    </div>
    <p>ì „êµ­ì˜ ìˆ¨ì€ í¬í† ìŠ¤íŒŸì„ ë°œê²¬í•˜ê³  ê³µìœ í•˜ì„¸ìš”</p>
  </header>

  <div class="container">
    <div class="nav-tabs">
      <button id="tab-list" class="active" onclick="switchView('list', this)">ğŸ“‹ ëª©ë¡</button>
      <button id="tab-map" onclick="switchView('map', this)">ğŸ—ºï¸ ì§€ë„</button>
      <button id="tab-favorite" onclick="switchView('favorite', this)">â¤ï¸ ì¢‹ì•„ìš”</button>
      <button id="tab-admin" onclick="switchView('admin', this)" style="margin-left: auto; background: #fff3cd; color: #856404;">ğŸ“ ê²Œì‹œë¬¼ ì—…ë¡œë“œ</button>
    </div>

    <div id="listView" class="view active">
      <div class="search-bar">
        <input id="searchInput" type="text" placeholder="í¬í† ìŠ¤íŒŸ ê²€ìƒ‰ (ì´ë¦„, ì„¤ëª…)...">
        <select id="filterProvince">
          <option value="">ê´‘ì—­ì‹œ/ë„ ì„ íƒ</option>
          <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
          <option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
          <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
          <option value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</option>
          <option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
          <option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</option>
          <option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
          <option value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
          <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
          <option value="ê°•ì›íŠ¹ë³„ìì¹˜ë„">ê°•ì›íŠ¹ë³„ìì¹˜ë„</option>
          <option value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</option>
          <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
          <option value="ì „ë¶íŠ¹ë³„ìì¹˜ë„">ì „ë¶íŠ¹ë³„ìì¹˜ë„</option>
          <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
          <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
          <option value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</option>
          <option value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
        </select>
        <select id="filterCity">
          <option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>
        </select>
      </div>
      <div class="list-view" id="spotsGrid"></div>
    </div>

    <div id="detailView" class="view detail-view">
      <div class="detail-header">
        <img id="detailImage" class="detail-image" src="" alt="">
        <button class="detail-back-btn" onclick="switchView('list', event)">â† ëª©ë¡</button>
      </div>
      <div class="detail-body">
        <h2 class="detail-title" id="detailTitle"></h2>
        <div class="detail-location" id="detailLocation"></div>
        <p class="detail-desc" id="detailDesc"></p>
        <div id="detailTags" style="margin-bottom: 16px;"></div>
        
        <div class="engagement-bar">
          <button class="engagement-btn" id="likeBtn" onclick="toggleLike()">
            <i class="fas fa-heart"></i> <span id="likeCount">0</span>
          </button>
          <button class="engagement-btn" onclick="document.querySelector('.comments-section').scrollIntoView({behavior: 'smooth'})">
            <i class="fas fa-comment"></i> <span id="commentCount">0</span>
          </button>
          <button class="engagement-btn" onclick="shareSpot()">
            <i class="fas fa-share"></i> ê³µìœ 
          </button>
        </div>

        <div class="detail-actions">
          <button class="detail-btn detail-btn-secondary" onclick="document.querySelector('.comments-section').scrollIntoView({behavior: 'smooth'})">
            <i class="fas fa-comment"></i> ëŒ“ê¸€ (<span id="actionCommentCount">0</span>)
          </button>
          <button class="detail-btn detail-btn-primary" onclick="document.getElementById('uploadInput').click()">
            <i class="fas fa-camera"></i> ì‚¬ì§„ ì—…ë¡œë“œ
          </button>
          <input id="uploadInput" type="file" accept="image/*" multiple style="display:none" onchange="onFileSelected(event)">
          <button class="detail-btn detail-btn-secondary" id="detailMapBtn" onclick="showMapImage()">
            <i class="fas fa-map-marked-alt"></i> ìœ„ì¹˜
          </button>
          <button class="detail-btn detail-btn-secondary" onclick="openMapDirection()">
            <i class="fas fa-directions"></i> ê¸¸ì°¾ê¸°
          </button>
          <button class="detail-btn detail-btn-secondary" id="editSpotBtn" onclick="toggleEditMode()" style="display: none; margin-left: auto;">
            <i class="fas fa-edit"></i> ìˆ˜ì •
          </button>
          <button class="detail-btn detail-btn-danger" id="deleteSpotBtn" onclick="deleteCurrentSpotInline()" style="display: none;">
            <i class="fas fa-trash-alt"></i> ì‚­ì œ
          </button>
        </div>

        <!-- ì‚¬ì§„ ê°¤ëŸ¬ë¦¬ -->
        <div id="photoGallery" class="photo-gallery" style="display: none;">
          <div class="gallery-container" id="galleryContainer"></div>
          <button class="gallery-nav prev" onclick="galleryPrev()" style="display: none;">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button class="gallery-nav next" onclick="galleryNext()" style="display: none;">
            <i class="fas fa-chevron-right"></i>
          </button>
          <button class="gallery-delete-btn" onclick="deleteCurrentGalleryImage()" style="display: none;">
            <i class="fas fa-trash-alt"></i>
          </button>
          <div class="gallery-indicators" id="galleryIndicators"></div>
          <div class="gallery-counter" id="galleryCounter"></div>
        </div>

        <!-- ì¸ë¼ì¸ ìˆ˜ì • í¼ -->
        <div id="inlineEditForm" style="display: none; background: #f9f9f9; padding: 20px; border-radius: 8px; margin: 20px 0; border: 2px solid #4caf50;">
          <h3 style="margin-bottom: 15px; color: #4caf50;">âœï¸ ê²Œì‹œë¬¼ ìˆ˜ì •</h3>
          <div style="display: grid; gap: 15px;">
            <div>
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">í¬í† ìŠ¤íŒŸ ì´ë¦„</label>
              <input id="inlineEditName" type="text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div>
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">ê´‘ì—­ì‹œ/ë„</label>
                <select id="inlineEditProvince" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                  <option value="">ì„ íƒ</option>
                  <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
                  <option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                  <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                  <option value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</option>
                  <option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                  <option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</option>
                  <option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                  <option value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
                  <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
                  <option value="ê°•ì›íŠ¹ë³„ìì¹˜ë„">ê°•ì›íŠ¹ë³„ìì¹˜ë„</option>
                  <option value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</option>
                  <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
                  <option value="ì „ë¶íŠ¹ë³„ìì¹˜ë„">ì „ë¶íŠ¹ë³„ìì¹˜ë„</option>
                  <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
                  <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
                  <option value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</option>
                  <option value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì‹œ/êµ°/êµ¬</label>
                <select id="inlineEditCity" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                  <option value="">ì„ íƒ</option>
                </select>
              </div>
            </div>
            <div>
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì„¸ë¶€ì£¼ì†Œ</label>
              <input id="inlineEditDetailAddress" type="text" placeholder="ì˜ˆ: ì/ë©´/ë™, 123-45ë²ˆì§€" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
            </div>
            <div>
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì„¤ëª…</label>
              <textarea id="inlineEditDesc" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;"></textarea>
            </div>
            <div>
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
              <input id="inlineEditTags" type="text" placeholder="#íƒœê·¸1,#íƒœê·¸2" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
            </div>
            <div>
              <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì´ë¯¸ì§€ URL</label>
              <input id="inlineEditImg" type="text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
            </div>
            <div style="display: flex; gap: 10px;">
              <button onclick="saveInlineEdit()" style="flex: 1; padding: 12px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">âœ… ì €ì¥</button>
              <button onclick="cancelInlineEdit()" style="flex: 1; padding: 12px; background: #999; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ì·¨ì†Œ</button>
            </div>
          </div>
        </div>

        <!-- ê·¼ì²˜ ìˆ™ë°•ì—…ì†Œ ì¶”ì²œ -->
        <div id="nearbyAccommodations" class="nearby-section" style="display: none;">
          <h3>ğŸ¨ ê·¼ì²˜ ìˆ™ë°•ì—…ì†Œ</h3>
          <div id="accommodationsList" class="accommodations-list"></div>
          <button id="showMoreAccommodations" class="show-more-btn" style="display: none;" onclick="toggleShowMoreAccommodations()">
            <i class="fas fa-chevron-down"></i> ë”ë³´ê¸°
          </button>
        </div>

        <!-- ê·¼ì²˜ ë§›ì§‘ ì¶”ì²œ -->
        <div id="nearbyRestaurants" class="nearby-section" style="display: none;">
          <h3>ğŸ½ï¸ ê·¼ì²˜ ë§›ì§‘</h3>
          <div id="restaurantsList" class="accommodations-list"></div>
          <button id="showMoreRestaurants" class="show-more-btn" style="display: none;" onclick="toggleShowMoreRestaurants()">
            <i class="fas fa-chevron-down"></i> ë”ë³´ê¸°
          </button>
        </div>

        <div class="comments-section">
          <h3>ğŸ’¬ ëŒ“ê¸€ (<span id="totalComments">0</span>)</h3>
          <div class="comment-form">
            <input id="commentInput" type="text" placeholder="ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”...">
            <button onclick="addComment()">ëŒ“ê¸€ ì“°ê¸°</button>
          </div>
          <div id="commentsList"></div>
        </div>
      </div>
    </div>

    <div id="mapView" class="view">
      <div style="padding: 15px; background: white; border-radius: 8px; margin-bottom: 10px; text-align: center;">
        <h3 style="margin: 0; color: #666;">ğŸ—ºï¸ ì „ì²´ í¬í† ìŠ¤íŒŸ ì§€ë„</h3>
      </div>
      <div class="map-view">
        <div id="mapContainer"></div>
      </div>
    </div>

    <div id="favoriteView" class="view">
      <div class="list-view" id="favoriteGrid"></div>
    </div>

    <div id="mapModal" class="map-modal" onclick="closeMapModal(event)">
      <div class="map-modal-content" onclick="event.stopPropagation()">
        <button class="map-modal-close" onclick="closeMapModal()">Ã—</button>
        <img id="mapModalImage" src="" alt="ìœ„ì¹˜ ì§€ë„">
      </div>
    </div>

    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div id="loginModal" class="auth-modal">
      <div class="auth-modal-content">
        <h2>ğŸ” ë¡œê·¸ì¸</h2>
        <div class="auth-error" id="loginError"></div>
        <form class="auth-form" onsubmit="handleLogin(event)">
          <input type="text" id="loginUsername" placeholder="ì‚¬ìš©ìëª…" required>
          <input type="password" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
          <button type="submit">ë¡œê·¸ì¸</button>
          <button type="button" class="cancel-btn" onclick="closeLoginModal()">ì·¨ì†Œ</button>
        </form>
      </div>
    </div>

    <!-- íšŒì›ê°€ì… ëª¨ë‹¬ -->
    <div id="registerModal" class="auth-modal">
      <div class="auth-modal-content">
        <h2>âœ¨ íšŒì›ê°€ì…</h2>
        <div class="auth-error" id="registerError"></div>
        <form class="auth-form" onsubmit="handleRegister(event)">
          <input type="text" id="registerUsername" placeholder="ì‚¬ìš©ìëª… (4ì ì´ìƒ)" required minlength="4">
          <input type="text" id="registerNickname" placeholder="ë‹‰ë„¤ì„" required>
          <input type="password" id="registerPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ (4ì ì´ìƒ)" required minlength="4">
          <button type="submit">ê°€ì…í•˜ê¸°</button>
          <button type="button" class="cancel-btn" onclick="closeRegisterModal()">ì·¨ì†Œ</button>
        </form>
      </div>
    </div>

    <div id="adminView" class="view" style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
      <h2 style="margin-bottom: 20px;">ğŸ“ ê²Œì‹œë¬¼ ì—…ë¡œë“œ</h2>
      <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
        <button onclick="addNewSpot()" style="padding: 10px 16px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">â• ìƒˆ í¬í† ìŠ¤íŒŸ ì¶”ê°€</button>
      </div>
      <div id="adminForm" style="display: none; background: #f9f9f9; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
          <div style="grid-column: 1 / -1; display:flex; gap:8px; align-items:center;">
            <input id="placeQuery" type="text" placeholder="ë„¤ì´ë²„ì—ì„œ ì¥ì†Œ/ì£¼ì†Œ ê²€ìƒ‰" style="flex:1; padding:10px; border:1px solid #ddd; border-radius:6px;">
            <button onclick="searchNaverPlace()" style="padding: 10px 16px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ğŸ” ì¥ì†Œ ê²€ìƒ‰</button>
          </div>
          <div id="placeResults" style="grid-column: 1 / -1; display:none; background:#fff; border:1px solid #ddd; border-radius:6px; max-height:200px; overflow:auto;"></div>
          <div style="grid-column: 1 / -1;">
            <label style="display: block; margin-bottom: 5px; font-weight: 600;">í¬í† ìŠ¤íŒŸ ì´ë¦„</label>
            <input id="editName" type="text" placeholder="ì˜ˆ: ë‚¨ì‚° íŒ”ê°ì • í¬í† ì¡´" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ëŒ€ë¶„ë¥˜ (íŠ¹ë³„ì‹œ/ê´‘ì—­ì‹œ/ë„)</label>
            <select id="editProvince" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
              <option value="">ì„ íƒ</option>
              <option value="ì„œìš¸íŠ¹ë³„ì‹œ">ì„œìš¸íŠ¹ë³„ì‹œ</option>
              <option value="ë¶€ì‚°ê´‘ì—­ì‹œ">ë¶€ì‚°ê´‘ì—­ì‹œ</option>
              <option value="ëŒ€êµ¬ê´‘ì—­ì‹œ">ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
              <option value="ì¸ì²œê´‘ì—­ì‹œ">ì¸ì²œê´‘ì—­ì‹œ</option>
              <option value="ê´‘ì£¼ê´‘ì—­ì‹œ">ê´‘ì£¼ê´‘ì—­ì‹œ</option>
              <option value="ëŒ€ì „ê´‘ì—­ì‹œ">ëŒ€ì „ê´‘ì—­ì‹œ</option>
              <option value="ìš¸ì‚°ê´‘ì—­ì‹œ">ìš¸ì‚°ê´‘ì—­ì‹œ</option>
              <option value="ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ">ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
              <option value="ê²½ê¸°ë„">ê²½ê¸°ë„</option>
              <option value="ê°•ì›íŠ¹ë³„ìì¹˜ë„">ê°•ì›íŠ¹ë³„ìì¹˜ë„</option>
              <option value="ì¶©ì²­ë¶ë„">ì¶©ì²­ë¶ë„</option>
              <option value="ì¶©ì²­ë‚¨ë„">ì¶©ì²­ë‚¨ë„</option>
              <option value="ì „ë¶íŠ¹ë³„ìì¹˜ë„">ì „ë¶íŠ¹ë³„ìì¹˜ë„</option>
              <option value="ì „ë¼ë‚¨ë„">ì „ë¼ë‚¨ë„</option>
              <option value="ê²½ìƒë¶ë„">ê²½ìƒë¶ë„</option>
              <option value="ê²½ìƒë‚¨ë„">ê²½ìƒë‚¨ë„</option>
              <option value="ì œì£¼íŠ¹ë³„ìì¹˜ë„">ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
            </select>
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì¤‘ë¶„ë¥˜ (ì‹œ/êµ°/êµ¬)</label>
            <select id="editCity" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
              <option value="">ì„ íƒ</option>
            </select>
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì„¸ë¶€ì£¼ì†Œ</label>
            <input id="editDetailAddress" type="text" placeholder="ì˜ˆ: ì/ë©´/ë™, 123-45ë²ˆì§€" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì„¤ëª…</label>
            <input id="editDesc" type="text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
          </div>

          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 600;">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
            <input id="editTags" type="text" placeholder="#íƒœê·¸1,#íƒœê·¸2" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì´ë¯¸ì§€ URL</label>
            <input id="editImg" type="text" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
          </div>
        </div>
        <div style="display: flex; gap: 10px;">
          <button onclick="saveEditData()" style="padding: 10px 16px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">âœ… ì €ì¥</button>
          <button onclick="deleteSpot()" style="padding: 10px 16px; background: #f44336; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ğŸ—‘ï¸ ì‚­ì œ</button>
          <button onclick="cancelEdit()" style="padding: 10px 16px; background: #999; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">ì·¨ì†Œ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ ëª¨ë‹¬ -->
  <div id="adminLoginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: white; padding: 30px; border-radius: 12px; max-width: 400px; width: 90%;">
      <h2 style="margin-bottom: 20px; color: #f39c12;">ğŸ‘‘ ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
      <input id="adminUsername" type="text" placeholder="ê´€ë¦¬ì ID" style="width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
      <input id="adminPassword" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" style="width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
      <div style="display: flex; gap: 10px;">
        <button onclick="adminLogin()" style="flex: 1; padding: 12px; background: #f39c12; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">ë¡œê·¸ì¸</button>
        <button onclick="closeAdminLoginModal()" style="flex: 1; padding: 12px; background: #95a5a6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>
  
  <script>

    // ============ API ì„¤ì • ============
    const API_BASE_URL = window.location.hostname === 'localhost' 
      ? 'http://localhost:3000' 
      : `https://${window.location.hostname.replace('-8000', '-3000')}`;

    console.log('API Base URL:', API_BASE_URL);

    // ============ ëŒ€í•œë¯¼êµ­ í–‰ì •êµ¬ì—­ ë°ì´í„° ============
    const koreanRegions = {
      'ì„œìš¸íŠ¹ë³„ì‹œ': ['ì¢…ë¡œêµ¬', 'ì¤‘êµ¬', 'ìš©ì‚°êµ¬', 'ì„±ë™êµ¬', 'ê´‘ì§„êµ¬', 'ë™ëŒ€ë¬¸êµ¬', 'ì¤‘ë‘êµ¬', 'ì„±ë¶êµ¬', 'ê°•ë¶êµ¬', 'ë„ë´‰êµ¬', 'ë…¸ì›êµ¬', 'ì€í‰êµ¬', 'ì„œëŒ€ë¬¸êµ¬', 'ë§ˆí¬êµ¬', 'ì–‘ì²œêµ¬', 'ê°•ì„œêµ¬', 'êµ¬ë¡œêµ¬', 'ê¸ˆì²œêµ¬', 'ì˜ë“±í¬êµ¬', 'ë™ì‘êµ¬', 'ê´€ì•…êµ¬', 'ì„œì´ˆêµ¬', 'ê°•ë‚¨êµ¬', 'ì†¡íŒŒêµ¬', 'ê°•ë™êµ¬'],
      'ë¶€ì‚°ê´‘ì—­ì‹œ': ['ì¤‘êµ¬', 'ì„œêµ¬', 'ë™êµ¬', 'ì˜ë„êµ¬', 'ë¶€ì‚°ì§„êµ¬', 'ë™ë˜êµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'í•´ìš´ëŒ€êµ¬', 'ì‚¬í•˜êµ¬', 'ê¸ˆì •êµ¬', 'ê°•ì„œêµ¬', 'ì—°ì œêµ¬', 'ìˆ˜ì˜êµ¬', 'ì‚¬ìƒêµ¬', 'ê¸°ì¥êµ°'],
      'ëŒ€êµ¬ê´‘ì—­ì‹œ': ['ì¤‘êµ¬', 'ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ìˆ˜ì„±êµ¬', 'ë‹¬ì„œêµ¬', 'ë‹¬ì„±êµ°', 'êµ°ìœ„êµ°'],
      'ì¸ì²œê´‘ì—­ì‹œ': ['ì¤‘êµ¬', 'ë™êµ¬', 'ë¯¸ì¶”í™€êµ¬', 'ì—°ìˆ˜êµ¬', 'ë‚¨ë™êµ¬', 'ë¶€í‰êµ¬', 'ê³„ì–‘êµ¬', 'ì„œêµ¬', 'ê°•í™”êµ°', 'ì˜¹ì§„êµ°'],
      'ê´‘ì£¼ê´‘ì—­ì‹œ': ['ë™êµ¬', 'ì„œêµ¬', 'ë‚¨êµ¬', 'ë¶êµ¬', 'ê´‘ì‚°êµ¬'],
      'ëŒ€ì „ê´‘ì—­ì‹œ': ['ë™êµ¬', 'ì¤‘êµ¬', 'ì„œêµ¬', 'ìœ ì„±êµ¬', 'ëŒ€ë•êµ¬'],
      'ìš¸ì‚°ê´‘ì—­ì‹œ': ['ì¤‘êµ¬', 'ë‚¨êµ¬', 'ë™êµ¬', 'ë¶êµ¬', 'ìš¸ì£¼êµ°'],
      'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ': ['ì„¸ì¢…ì‹œ'],
      'ê²½ê¸°ë„': ['ìˆ˜ì›ì‹œ', 'ì„±ë‚¨ì‹œ', 'ê³ ì–‘ì‹œ', 'ìš©ì¸ì‹œ', 'ë¶€ì²œì‹œ', 'ì•ˆì‚°ì‹œ', 'ì•ˆì–‘ì‹œ', 'ë‚¨ì–‘ì£¼ì‹œ', 'í™”ì„±ì‹œ', 'í‰íƒì‹œ', 'ì˜ì •ë¶€ì‹œ', 'ì‹œí¥ì‹œ', 'íŒŒì£¼ì‹œ', 'ê´‘ëª…ì‹œ', 'ê¹€í¬ì‹œ', 'êµ°í¬ì‹œ', 'ê´‘ì£¼ì‹œ', 'ì´ì²œì‹œ', 'ì–‘ì£¼ì‹œ', 'ì˜¤ì‚°ì‹œ', 'êµ¬ë¦¬ì‹œ', 'ì•ˆì„±ì‹œ', 'í¬ì²œì‹œ', 'ì˜ì™•ì‹œ', 'í•˜ë‚¨ì‹œ', 'ì—¬ì£¼ì‹œ', 'ì–‘í‰êµ°', 'ë™ë‘ì²œì‹œ', 'ê³¼ì²œì‹œ', 'ê°€í‰êµ°', 'ì—°ì²œêµ°'],
      'ê°•ì›íŠ¹ë³„ìì¹˜ë„': ['ì¶˜ì²œì‹œ', 'ì›ì£¼ì‹œ', 'ê°•ë¦‰ì‹œ', 'ë™í•´ì‹œ', 'íƒœë°±ì‹œ', 'ì†ì´ˆì‹œ', 'ì‚¼ì²™ì‹œ', 'í™ì²œêµ°', 'íš¡ì„±êµ°', 'ì˜ì›”êµ°', 'í‰ì°½êµ°', 'ì •ì„ êµ°', 'ì² ì›êµ°', 'í™”ì²œêµ°', 'ì–‘êµ¬êµ°', 'ì¸ì œêµ°', 'ê³ ì„±êµ°', 'ì–‘ì–‘êµ°'],
      'ì¶©ì²­ë¶ë„': ['ì²­ì£¼ì‹œ', 'ì¶©ì£¼ì‹œ', 'ì œì²œì‹œ', 'ë³´ì€êµ°', 'ì˜¥ì²œêµ°', 'ì˜ë™êµ°', 'ì¦í‰êµ°', 'ì§„ì²œêµ°', 'ê´´ì‚°êµ°', 'ìŒì„±êµ°', 'ë‹¨ì–‘êµ°'],
      'ì¶©ì²­ë‚¨ë„': ['ì²œì•ˆì‹œ', 'ê³µì£¼ì‹œ', 'ë³´ë ¹ì‹œ', 'ì•„ì‚°ì‹œ', 'ì„œì‚°ì‹œ', 'ë…¼ì‚°ì‹œ', 'ê³„ë£¡ì‹œ', 'ë‹¹ì§„ì‹œ', 'ê¸ˆì‚°êµ°', 'ë¶€ì—¬êµ°', 'ì„œì²œêµ°', 'ì²­ì–‘êµ°', 'í™ì„±êµ°', 'ì˜ˆì‚°êµ°', 'íƒœì•ˆêµ°'],
      'ì „ë¶íŠ¹ë³„ìì¹˜ë„': ['ì „ì£¼ì‹œ', 'êµ°ì‚°ì‹œ', 'ìµì‚°ì‹œ', 'ì •ìì‹œ', 'ë‚¨ì›ì‹œ', 'ê¹€ì œì‹œ', 'ì™„ì£¼êµ°', 'ì§„ì•ˆêµ°', 'ë¬´ì£¼êµ°', 'ì¥ìˆ˜êµ°', 'ì„ì‹¤êµ°', 'ìˆœì°½êµ°', 'ê³ ì°½êµ°', 'ë¶€ì•ˆêµ°'],
      'ì „ë¼ë‚¨ë„': ['ëª©í¬ì‹œ', 'ì—¬ìˆ˜ì‹œ', 'ìˆœì²œì‹œ', 'ë‚˜ì£¼ì‹œ', 'ê´‘ì–‘ì‹œ', 'ë‹´ì–‘êµ°', 'ê³¡ì„±êµ°', 'êµ¬ë¡€êµ°', 'ê³ í¥êµ°', 'ë³´ì„±êµ°', 'í™”ìˆœêµ°', 'ì¥í¥êµ°', 'ê°•ì§„êµ°', 'í•´ë‚¨êµ°', 'ì˜ì•”êµ°', 'ë¬´ì•ˆêµ°', 'í•¨í‰êµ°', 'ì˜ê´‘êµ°', 'ì¥ì„±êµ°', 'ì™„ë„êµ°', 'ì§„ë„êµ°', 'ì‹ ì•ˆêµ°'],
      'ê²½ìƒë¶ë„': ['í¬í•­ì‹œ', 'ê²½ì£¼ì‹œ', 'ê¹€ì²œì‹œ', 'ì•ˆë™ì‹œ', 'êµ¬ë¯¸ì‹œ', 'ì˜ì£¼ì‹œ', 'ì˜ì²œì‹œ', 'ìƒì£¼ì‹œ', 'ë¬¸ê²½ì‹œ', 'ê²½ì‚°ì‹œ', 'ì˜ì„±êµ°', 'ì²­ì†¡êµ°', 'ì˜ì–‘êµ°', 'ì˜ë•êµ°', 'ì²­ë„êµ°', 'ê³ ë ¹êµ°', 'ì„±ì£¼êµ°', 'ì¹ ê³¡êµ°', 'ì˜ˆì²œêµ°', 'ë´‰í™”êµ°', 'ìš¸ì§„êµ°', 'ìš¸ë¦‰êµ°'],
      'ê²½ìƒë‚¨ë„': ['ì°½ì›ì‹œ', 'ì§„ì£¼ì‹œ', 'í†µì˜ì‹œ', 'ì‚¬ì²œì‹œ', 'ê¹€í•´ì‹œ', 'ë°€ì–‘ì‹œ', 'ê±°ì œì‹œ', 'ì–‘ì‚°ì‹œ', 'ì˜ë ¹êµ°', 'í•¨ì•ˆêµ°', 'ì°½ë…•êµ°', 'ê³ ì„±êµ°', 'ë‚¨í•´êµ°', 'í•˜ë™êµ°', 'ì‚°ì²­êµ°', 'í•¨ì–‘êµ°', 'ê±°ì°½êµ°', 'í•©ì²œêµ°'],
      'ì œì£¼íŠ¹ë³„ìì¹˜ë„': ['ì œì£¼ì‹œ', 'ì„œê·€í¬ì‹œ']
    };

    // ============ DATA with CORRECT COORDINATES ============
    const spotsData = [
      { id: 's1', name: 'ë‚¨ì‚° íŒ”ê°ì • í¬í† ì¡´', province: 'ì„œìš¸íŠ¹ë³„ì‹œ', city: 'ì¤‘êµ¬', district: 'ë‚¨ì‚°ë™', detailAddress: 'ë‚¨ì‚° íŒ”ê°ì •', desc: 'ì„œìš¸ ì•¼ê²½ì„ ë°°ê²½ìœ¼ë¡œ í•œ ê°ì„± í¬í† ìŠ¤íŒŸ. ë°¤ ì‹œê°„ì´ íŠ¹íˆ ì•„ë¦„ë‹µìŠµë‹ˆë‹¤.', tags: ['#ì•¼ê²½','#ì‚¬ê³„ì ˆ','#íŒ”ê°ì •'], lat: 37.5505, lng: 126.9877, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNTEwMTVfMTU1%2FMDAxNzYwNTEzNTQ2NDI5.BAHVHl81uwJjXxyFrCMosrS_rWNf5H-0vW2nFsPaGYIg.6W5EAt0buel1jupOmRrB_JCekcQMWVwgFgWnaOMP4-Qg.JPEG%2FSE-152F2045-F137-427F-BBFB-CAC036C0FCBB.jpg&type=sc960_832', likes: 245 },
      { id: 's2', name: 'ë¶ì´Œ í•œì˜¥ë§ˆì„ í¬í† ìŠ¤íŒŸ', province: 'ì„œìš¸íŠ¹ë³„ì‹œ', city: 'ì¢…ë¡œêµ¬', district: 'ê°€íšŒë™', detailAddress: 'ë¶ì´Œë¡œ ì¼ëŒ€', desc: 'ì „í†µ í•œì˜¥ê³¼ í˜„ëŒ€ ê°ì„±ì´ ì–´ìš°ëŸ¬ì§„ í¬í† ì¡´. í•œë³µ ëŒ€ì—¬ì†Œë„ ë§ìŒ.', tags: ['#í•œì˜¥','#ì „í†µ','#ê°ì„±'], lat: 37.5801, lng: 126.9777, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMjA2MDRfMjQy%2FMDAxNjU0MzE0NDU1NDE5.xshpiNkFoUEY4AfKN-8ScTX8khyWA_qo2w0sa5GKwPYg.LTDjZvjZB9qryr6A-80A4zphEyQz-b8e0O0IYD2QYlgg.JPEG.1127qaz%2FIMG_5136.jpg&type=sc960_832', likes: 189 },
      { id: 's3', name: 'ê²½ë³µê¶ ì•¼ê²½ í¬í† ì¡´', province: 'ì„œìš¸íŠ¹ë³„ì‹œ', city: 'ì¢…ë¡œêµ¬', district: 'ì„¸ì¢…ë¡œ', detailAddress: 'ê²½ë³µê¶ ì •ë¬¸', desc: 'ë°¤ì— ì¡°ëª…ì´ ë“¤ì–´ì˜¤ëŠ” ê²½ë³µê¶. í•œêµ­ ì „í†µë¯¸ë¥¼ ë‹´ì„ ìˆ˜ ìˆëŠ” ìµœê³ ì˜ ì¥ì†Œ.', tags: ['#ì•¼ê²½','#ê¶ê¶','#ì•¼ê²½'], lat: 37.5949, lng: 126.9776, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNTA2MDJfNDYg%2FMDAxNzQ4ODU1ODQ5ODU3.5HpMfI0tcb8XlxN3skYCd_TRKiz3U7bF-KIXxbMOWX8g.yo0QJxSLIpUiMpibReFk6qOKJCstg0tjfp-6Wy44XEgg.JPEG%2F20250528%25A3%25DF202517.jpg&type=sc960_832', likes: 312 },
      { id: 's4', name: 'ê°ì²œë¬¸í™”ë§ˆì„', province: 'ë¶€ì‚°ê´‘ì—­ì‹œ', city: 'ì‚¬í•˜êµ¬', district: 'ê°ì²œë™', detailAddress: 'ê°ë‚´2ë¡œ', desc: 'ì•Œë¡ë‹¬ë¡í•œ ì§‘ë“¤ì´ ì‚° ì–¸ë•ì— í¼ì³ì§„ í¬í† ì¡´. ë¶€ì‚°ì˜ ìˆ¨ì€ ë³´ì„.', tags: ['#ìƒ‰ê°','#ë§ˆì„','#ë¶€ì‚°'], lat: 35.0977, lng: 129.0653, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMTEyMDdfNDQg%2FMDAxNjM4ODcwNjc5ODc5.BUSzOCm0IMAmJ4EVbLGX4QCMvwBqgYJdD4d7j9yqGwgg.tI9BbmRRNi9qLBTAjzoMzmoSCOkAqD7I5qmcYKzAs5Yg.GIF.wiz_js%2F20211206%25A3%25DF181451%25A3%25A80%25A3%25A9.gif&type=sc960_832_gif', likes: 267 },
      { id: 's5', name: 'ì „ì£¼ í•œì˜¥ë§ˆì„', province: 'ì „ë¶íŠ¹ë³„ìì¹˜ë„', city: 'ì „ì£¼ì‹œ', district: 'ì™„ì‚°êµ¬ í’ë‚¨ë™', detailAddress: 'ì–´ì§„ê¸¸ ì¼ëŒ€', desc: 'ì „í†µ í•œì˜¥ì´ ê°€ë“í•œ ë§ˆì„ì˜ ì•¼ê²½. ì •ê° ìˆëŠ” ëŠë‚Œì˜ ì‚¬ì§„ì„ ë‹´ì„ ìˆ˜ ìˆìŒ.', tags: ['#í•œì˜¥','#ì•¼ê²½','#ì „ì£¼'], lat: 35.8242, lng: 127.1410, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDA3MDNfMjI2%2FMDAxNzE5OTM3NjYwMjA2.61Fy6edtTMgdwU44_nmw5RXNfMjxrsXJKMyuRxinGHog.g5NuJeAC4w6JXFle1GA66vbTDH5t1fzshY8xWwwgttgg.JPEG%2F1_%25A1%25DA%25B8%25DE%25C0%25CE%25BB%25E7%25C1%25F8%25A1%25DA.jpg&type=sc960_832', likes: 198 },
      { id: 's6', name: 'ìì‘ë‚˜ë¬´ ìˆ²', province: 'ê°•ì›íŠ¹ë³„ìì¹˜ë„', city: 'ì¸ì œêµ°', district: 'ì›ëŒ€ë¦¬', detailAddress: 'ìì‘ë‚˜ë¬´ìˆ²ê¸¸', desc: 'í‘¸ë¥¸ ìì—° ì† í•œì í•œ ìˆ²ê¸¸. ì‚°ë¦¼ìš•ê³¼ ì‚¬ì§„ì´¬ì˜ì„ ë™ì‹œì— ì¦ê¸¸ ìˆ˜ ìˆëŠ” ê³³.', tags: ['#ìì—°','#ì‚°','#ìˆ²'], lat: 37.8917, lng: 128.2019, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAxNzEwMDlfMTAx%2FMDAxNTA3NDc4MTY4OTMw.4RV0ECR2aFiOOCgyc3rE2EvwtdAdr2-sj742DmOV7q8g.ppkMFdzG9AcYanFxQuWVyCd7tGBydrSpEqc6BDYYx-Yg.JPEG.durden09%2F207.JPG&type=sc960_832', likes: 156 },
      { id: 's7', name: 'í•´ìš´ëŒ€ í•´ë³€ ì¼ëª° í¬ì¸íŠ¸', province: 'ë¶€ì‚°ê´‘ì—­ì‹œ', city: 'í•´ìš´ëŒ€êµ¬', district: 'ìš°ë™', detailAddress: 'í•´ìš´ëŒ€í•´ë³€ë¡œ', desc: 'ë¶€ì‚° í•´ìš´ëŒ€ì˜ ì•„ë¦„ë‹¤ìš´ ì¼ëª° í¬ì¸íŠ¸. ì €ë… ì‹œê°„ ë°©ë¬¸ ê¶Œì¥.', tags: ['#ì¼ëª°','#í•´ë³€','#ë¶€ì‚°'], lat: 35.1607, lng: 129.1608, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAxNzAyMTNfMjQy%2FMDAxNDg2OTE0Njc5MzEy.uk3ZIeKHhdgCI2NbN-OIBpcmAR3-vWZkedIDE6VbHUMg.bRoYu0X0pbHFlYPZlme-Ub2xTRDZTRLrz9qW0bzB3ygg.PNG.pjhadan%2F%25B9%25CC%25C6%25F75-1.png&type=sc960_832', likes: 284 },
      { id: 's8', name: 'ì•„ì¹¨ê³ ìš”ìˆ˜ëª©ì›', province: 'ê²½ê¸°ë„', city: 'ê°€í‰êµ°', district: 'ìƒë©´', detailAddress: 'ìˆ˜ëª©ì›ë¡œ 432', desc: 'ê³„ì ˆë§ˆë‹¤ ë‹¤ì–‘í•œ ì‹ë¬¼ê³¼ ê½ƒì„ ë³¼ ìˆ˜ ìˆëŠ” í¬í† ì¡´. ë´„ê³¼ ê°€ì„ì´ ìµœê³ .', tags: ['#ì‹ë¬¼','#ì •ì›','#ê³„ì ˆ'], lat: 37.3192, lng: 127.2125, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDA1MjRfMjU1%2FMDAxNzE2NTE0ODAwMzQ3.QGzqUHdJ7PouX56ckLhkOAaZxRoCJ_McuiX2ahjq0tAg.f7GQf38Sc2wXt3vRkE2oqzhPWSzkQjIv-KdpghCi33wg.JPEG%2FIMG_6938.jpg&type=sc960_832', likes: 167 },
      { id: 's9', name: 'ë•ìˆ˜ê¶ ì„ì¡°ì „', province: 'ì„œìš¸íŠ¹ë³„ì‹œ', city: 'ì¤‘êµ¬', district: 'ì •ë™', detailAddress: 'ë•ìˆ˜ê¶ê¸¸ 61', desc: 'ì‹ ê³ ë”• ì–‘ì‹ì˜ ì•„ë¦„ë‹¤ìš´ ê±´ì¶•ë¬¼. í´ë˜ì‹í•œ ì‚¬ì§„ì„ ì°ì„ ìˆ˜ ìˆëŠ” ê³³.', tags: ['#ê±´ì¶•','#í´ë˜ì‹','#ê¶ê¶'], lat: 37.5648, lng: 126.9629, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNTA4MDNfMjI4%2FMDAxNzU0MjAyMTg5NzY2.Oy7fzpdqj8Fw76LUWjSqniSGHW7hJbLMit0szzpXfkog.pn3LfMjnJFKFOBkarekeVwqBZbzkcY68_ks7YfmnhPgg.JPEG%2FIMG%25A3%25DF0076.JPG&type=sc960_832', likes: 223 },
      { id: 's10', name: 'ì •ë™ì§„ í•´ë³€', province: 'ê°•ì›íŠ¹ë³„ìì¹˜ë„', city: 'ê°•ë¦‰ì‹œ', district: 'ê°•ë™ë©´', detailAddress: 'ì •ë™ì§„ë¦¬', desc: 'ì˜ë™ì„  ê¸°ì°¨ë¥¼ ë°°ê²½ìœ¼ë¡œ í•œ ë…íŠ¹í•œ í¬í† ì¡´. ê¸°ì°¨ ì• í˜¸ê°€ë“¤ì´ ì°¾ëŠ” ê³³.', tags: ['#í•´ë³€','#ê¸°ì°¨','#ê°•ë¦‰'], lat: 37.3294, lng: 129.0123, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDAzMDdfNCAg%2FMDAxNzA5NzQ4NjczNDQy._Mvck3VSFVl6xXBvgdCyfTpqpXn_V6YOeKsIKprVwY8g.vvLS_-nPYun4hGgxPHDEkDTSQX2hvUCGfXVP90Iwz7Ig.PNG%2Fimage.png&type=sc960_832', likes: 198 },
      { id: 's11', name: 'ê²€ì€ëª¨ë˜í•´ë³€', province: 'ì œì£¼íŠ¹ë³„ìì¹˜ë„', city: 'ì œì£¼ì‹œ', district: 'êµ¬ì¢Œì', detailAddress: 'í•˜ë„ë¦¬', desc: 'ê²€ì€ ëª¨ë˜ê°€ íŠ¹ì§•ì¸ í•´ë³€. ë…íŠ¹í•œ ìƒ‰ê°ì˜ ì‚¬ì§„ì„ ë‹´ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', tags: ['#í•´ë³€','#ì œì£¼','#ê²€ì€ëª¨ë˜'], lat: 33.3117, lng: 126.4113, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNTAzMDVfMTk3%2FMDAxNzQxMTQ5MjAxOTEz.k4T-SoKL5UVacHeGawOTHKiqBfwflsdb6eqp8p11kv8g.iXZ0Zr2LmJoXM5P3xJXOfStOxMuAtJQbTNIb5cITBQUg.JPEG%2FIMG_5082%25281%2529.jpg&type=sc960_832', likes: 276 },
      { id: 's12', name: 'ëª…ë™ ì„±ë‹¹ ê±°ë¦¬', province: 'ì„œìš¸íŠ¹ë³„ì‹œ', city: 'ì¤‘êµ¬', district: 'ëª…ë™', detailAddress: 'ëª…ë™ê±°ë¦¬ ì¼ëŒ€', desc: 'ë°¤ê±°ë¦¬ ì¡°ëª…ê³¼ ì‡¼ìœˆë„ìš°ê°€ ì–´ìš°ëŸ¬ì§„ ë„ì‹œ ì•¼ê²½ì˜ ì •ìˆ˜.', tags: ['#ì•¼ê²½','#ë„ì‹œ','#ê±°ë¦¬'], lat: 37.5631, lng: 126.9824, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMjEyMjVfMTkx%2FMDAxNjcxOTUxNDA2MDQ0.GJmAXJuvEjuB7XU3pd25yigvaSfmWBQ7LmaVPnMgPLwg.NlAm1ybinguO5x_MLgg2151xvdwq42iBMBteJfO9Vjgg.JPEG.bluerose0328%2FDSC04777-16.jpg&type=sc960_832', likes: 241 },
      { id: 's13', name: 'ì„œì´Œ ê³¨ëª©ê¸¸', province: 'ì„œìš¸íŠ¹ë³„ì‹œ', city: 'ì¢…ë¡œêµ¬', district: 'í†µì˜ë™', detailAddress: 'í•„ìš´ëŒ€ë¡œ ì¼ëŒ€', desc: 'ì¹´í˜ì™€ ê°¤ëŸ¬ë¦¬ê°€ ê°€ë“í•œ ì˜ˆìˆ ê°€ ê°ì„±ì˜ ê±°ë¦¬. ì‚¬ì§„ì‘ê°€ë“¤ì´ ìì£¼ ì°¾ìŒ.', tags: ['#ê³¨ëª©','#í•œì˜¥','#ê°ì„±'], lat: 37.5769, lng: 126.9647, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMTEyMDJfMjkg%2FMDAxNjM4NDQ3ODMwODUy.oF9JuNCf7a4VnqBlr3r048NQeBrunuYdMu9ijOMS55Mg.4Z5YhIWkxa5thzYX1mUDj3t19MCJCQIsVUsYpfujcaAg.JPEG.yhw5031%2FIMG_0066.jpg&type=sc960_832', likes: 189 },
      { id: 's14', name: 'í•´ìƒì¼€ì´ë¸”ì¹´', province: 'ì „ë¼ë‚¨ë„', city: 'ì—¬ìˆ˜ì‹œ', district: 'ëŒì‚°ì', detailAddress: 'ëŒì‚°ê³µì› ì¼ëŒ€', desc: 'ë°”ë‹¤ ìœ„ë¥¼ ì§€ë‚˜ê°€ëŠ” ì¼€ì´ë¸”ì¹´. ìŠ¤ë¦´ìˆëŠ” ì‚¬ì§„ì„ ì›í•œë‹¤ë©´ ì´ê³³!', tags: ['#ë°”ë‹¤','#ì „ë§','#ì—¬ìˆ˜'], lat: 34.7604, lng: 127.7370, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDExMTJfOTIg%2FMDAxNzMxNDA3MDA4ODEw.NeWqHDZPhCTe7c0bRes_eeObonprMXpZ_CUDePMvbo0g.ej-mIcOHtK_m9Olhq_ttW3KzlTPACuyKq3XiN570ONAg.JPEG%2F1731407005901.jpg&type=sc960_832', likes: 205 },
      { id: 's15', name: 'ëŒ€ë‚˜ë¬´ìˆ²ê¸¸', province: 'ì „ë¼ë‚¨ë„', city: 'ë‹´ì–‘êµ°', district: 'ë‹´ì–‘ì', detailAddress: 'ë©”íƒ€ì„¸ì½°ì´ì•„ê¸¸ 119', desc: 'ëŒ€ë‚˜ë¬´ê°€ ìš°ê±°ì§„ ìˆ²ê¸¸. ì‹ ë¹„ë¡œìš´ ë¶„ìœ„ê¸°ì˜ ì‚¬ì§„ì„ ë‹´ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', tags: ['#ìˆ²','#ëŒ€ë‚˜ë¬´','#ë‹´ì–‘'], lat: 35.2981, lng: 126.9919, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMzA0MzBfMjEy%2FMDAxNjgyODU2NjYyNDYw.XKOh12ugcd53H4gLFhZeLj09SaUXa7qhZuQo6s5j4P8g.nK94vCQVET9fLwP_bnUz3M_wtduv6Goxb_alMH3z04kg.JPEG.pure_quf%2FP20230430_195550000_502A54B1-B4E6-4EFA-B940-434CCD057993.jpg&type=sc960_832', likes: 234 },
      { id: 's16', name: 'ì„œìš¸ìˆ²', province: 'ì„œìš¸íŠ¹ë³„ì‹œ', city: 'ì„±ë™êµ¬', district: 'ì„±ìˆ˜ë™', detailAddress: 'ëš¤ì„«ë¡œ 273', desc: 'ë„ì‹œ ì† ìì—° íœ´ì‹ì²˜. ë§¤ ê³„ì ˆ ì•„ë¦„ë‹¤ìš´ í’ê²½ì„ ë§Œë‚  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', tags: ['#ìì—°','#ê³µì›','#ì„œìš¸'], lat: 37.5447, lng: 127.0390, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMzA1MjFfMTEw%2FMDAxNjg0NjY5MDczNTY4.G44LCcXRuHcaq-UjeRlX-a3zuLKgj4EXRmHP7wBHccwg.gDX_fpE7lU_-lGR5x8hI9ep0CO6OCNxUXkErXGBIgFcg.JPEG.gkswldnjs22%2F20230521%25A3%25DF152820.jpg&type=sc960_832', likes: 201 },
      { id: 's17', name: 'ì—¬ì˜ë„ ë²šê½ƒê¸¸', province: 'ì„œìš¸íŠ¹ë³„ì‹œ', city: 'ì˜ë“±í¬êµ¬', district: 'ì—¬ì˜ë„ë™', detailAddress: 'ì—¬ì˜ì„œë¡œ', desc: 'ë´„ì—ëŠ” ë²šê½ƒì´ ë§Œë°œí•˜ëŠ” ìµœê³ ì˜ í¬í† ì¡´. ë°¤ì—ëŠ” ì•¼ê²½ë„ ì•„ë¦„ë‹µìŠµë‹ˆë‹¤.', tags: ['#ë²šê½ƒ','#ë´„','#ì•¼ê²½'], lat: 37.5263, lng: 126.9260, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDA0MDJfMiAg%2FMDAxNzEyMDI0OTk1NTI5.RY88yN1NhPwRRezcnIr8yuRZF5XGSI-8LYpEO9vxO3cg.tR47RGvJXCaDn82zKv8oJgl8rPYwGLWILD-Cc_6Q3igg.JPEG%2F20240402%25A3%25DF112824.jpg&type=sc960_832', likes: 289 },
      { id: 's18', name: 'í™ëŒ€ ë²½í™”ê³¨ëª©', province: 'ì„œìš¸íŠ¹ë³„ì‹œ', city: 'ë§ˆí¬êµ¬', district: 'ì„œêµë™', detailAddress: 'ì™€ìš°ì‚°ë¡œ ì¼ëŒ€', desc: 'ì˜ˆìˆ ê³¼ ê°ì„±ì´ í˜ëŸ¬ë„˜ì¹˜ëŠ” ê³¨ëª©. ë§¤ë²ˆ ìƒˆë¡œìš´ ë²½í™”ë¥¼ ë°œê²¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.', tags: ['#ë¯¸ìˆ ','#ê°ì„±','#í™ëŒ€'], lat: 37.5567, lng: 126.9230, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2F20150716_102%2Fqhadldhaus98_1437054710979z4lpf_JPEG%2FIMG_7201.JPG&type=sc960_832', likes: 267 },
      { id: 's19', name: 'ë…ì¼ë§ˆì„', province: 'ê²½ìƒë‚¨ë„', city: 'ë‚¨í•´êµ°', district: 'ì‚¼ë™ë©´', detailAddress: 'ë¬¼ê±´ë¦¬', desc: 'ì´êµ­ì ì¸ ë¶„ìœ„ê¸°ì˜ ê±´ì¶•ë¬¼ë“¤. ë§ˆì¹˜ ìœ ëŸ½ì— ì˜¨ ê²ƒ ê°™ì€ ëŠë‚Œì…ë‹ˆë‹¤.', tags: ['#ê±´ì¶•','#ì´êµ­ì ','#ë‚¨í•´'], lat: 34.8589, lng: 128.0754, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fimgnews.naver.net%2Fimage%2F005%2F2024%2F09%2F04%2F2024090413441674796_1725425057_0020491127_20240904134709416.jpg&type=sc960_832', likes: 215 },
      { id: 's20', name: 'ì£½ë„í•´ë³€ ë™êµ´', province: 'ê²½ìƒë¶ë„', city: 'í¬í•­ì‹œ', district: 'ë¶êµ¬ ë‘í˜¸ë™', detailAddress: 'í†µì¼ë¡œ 406', desc: 'í‰ì˜¨í•œ í•´ë³€ê³¼ ë“±ëŒ€ì˜ ì¡°í•©. ì¼ì¶œ ì´¬ì˜ì˜ ëª…ì†Œì…ë‹ˆë‹¤.', tags: ['#í•´ë³€','#ì¼ì¶œ','#í¬í•­'], lat: 36.0329, lng: 129.3708, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMzA3MTlfMTUx%2FMDAxNjg5NzY3ODcyMjYw.93QEWv7PzcUxNCFIRQ7y214UVL9Zz9UzwM-mu6O5-LUg.mSqzY9l7k9JBBqYJLtvFCJ0dnx3Yt8nJhw4cebwzZMcg.JPEG.sunhye2430%2FIMG_6088.JPG&type=sc960_832', likes: 172 },
      { id: 's21', name: 'ë¶ˆêµ­ì‚¬', province: 'ê²½ìƒë¶ë„', city: 'ê²½ì£¼ì‹œ', district: 'ì§„í˜„ë™', detailAddress: 'ë¶ˆêµ­ë¡œ 385', desc: 'ì—­ì‚¬ì™€ ë¬¸í™”ê°€ ë‹´ê¸´ ì‚¬ì°°. ì‚¬ê³„ì ˆ ëª¨ë‘ ì•„ë¦„ë‹¤ìš´ í¬í† ì¡´ì…ë‹ˆë‹¤.', tags: ['#ì‚¬ì°°','#ì—­ì‚¬','#ê²½ì£¼'], lat: 35.7894, lng: 129.2183, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDExMjVfMjcw%2FMDAxNzMyNTMyNTk0NzMy.lOyBH0hZGutIrVG9yGth0ptAo1YglRGXj_gVNxvODGcg.kcRK1oFg5NgfQ2g34irBtHu5ROd2OuGmECGakOUNWDog.JPEG%2FDHK_6874.jpg&type=sc960_832', likes: 243 },
      { id: 's22', name: 'ë™í”¼ë‘ ë²½í™”ë§ˆì„', province: 'ê²½ìƒë‚¨ë„', city: 'í†µì˜ì‹œ', district: 'ë™í˜¸ë™', detailAddress: 'ë™í”¼ë‘ê¸¸', desc: 'í•­êµ¬ë„ì‹œì˜ ê°ì„±ì„ ë‹´ì€ ë²½í™”ë§ˆì„. í•˜ëŠ˜ìƒ‰ ë°”ë‹¤ê°€ ì¸ìƒìƒ· ë°°ê²½ì…ë‹ˆë‹¤.', tags: ['#ë²½í™”','#ë°”ë‹¤','#í†µì˜'], lat: 34.9227, lng: 128.5628, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDA4MDVfMTk3%2FMDAxNzIyODMwMDI0ODU3.c08xWhePlQbklyCKRELmzJDl3OLGQO6jZfSVRCvoQWUg.b3BQEWIIXxku5DcBI3eJWF7snelYtkC5zBu2MlMG8A4g.JPEG%2Foutput_3979949709.jpg&type=sc960_832', likes: 291 },
      { id: 's23', name: 'ë‚´ì¥ì‚°', province: 'ì „ë¶íŠ¹ë³„ìì¹˜ë„', city: 'ì •ìì‹œ', district: 'ë‚´ì¥ë™', detailAddress: 'ë‚´ì¥ì‚°ë¡œ', desc: 'ê°€ì„ ë‹¨í’ì˜ ì ˆì •. ë“±ì‚° í›„ í¬í† ì¡´ì„ ë‹¤ì–‘í•˜ê²Œ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', tags: ['#ë‹¨í’','#ì‚°','#ê°€ì„'], lat: 35.6819, lng: 127.2089, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNTExMDlfMTYw%2FMDAxNzYyNjU1MTE2ODI0.64pN8WPn00VTxZAWevMhM5AX8zpj2rC1cyrpBZJTfocg.MGKW_i3mXEOUjKp1Y5DpzaohwYtfxnrQm1gPxlqbdZcg.PNG%2Fimage_fc5e9286.png&type=sc960_832', likes: 187 },
      { id: 's24', name: 'ë§¤ë´‰ê³µì›', province: 'ê´‘ì£¼ê´‘ì—­ì‹œ', city: 'ë¶êµ¬', district: 'ê°í™”ë™', detailAddress: 'ë§¤ë´‰ë¡œ 30', desc: 'ê´‘ì£¼ ì•¼ê²½ì˜ ìµœê³  í¬ì¸íŠ¸. ë§‘ì€ ë‚ ì”¨ì˜ ë°¤ì€ ì •ë§ ì•„ë¦„ë‹µìŠµë‹ˆë‹¤.', tags: ['#ì•¼ê²½','#ê³µì›','#ê´‘ì£¼'], lat: 35.1396, lng: 126.9136, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMTA2MTZfMTcy%2FMDAxNjIzODIwOTgwMjcz.UWKwwChH-Vj2gFmrKfVqhrWYStwQzsNase8ESXflx4Ig.9uS_HddVUotQjllYTwV6_EZizGs1cqogX33w6Q5A1kwg.JPEG.5617kmy%2F1623820917586.jpg&type=sc960_832', likes: 156 },
      { id: 's25', name: 'êµ¬ë´‰ëŒ', province: 'ê°•ì›íŠ¹ë³„ìì¹˜ë„', city: 'ì¶˜ì²œì‹œ', district: 'ì‹ ë™ë©´', detailAddress: 'êµ¬ë´‰ëŒë¡œ', desc: 'í˜¸ìˆ˜ë¥¼ ë°°ê²½ìœ¼ë¡œ í•œ ê°ì„± ì‚¬ì§„ì´¬ì˜ì§€. ì•„ì¹¨ ì•ˆê°œë„ ë©‹ì§‘ë‹ˆë‹¤.', tags: ['#í˜¸ìˆ˜','#ê°ì„±','#ì¶˜ì²œ'], lat: 37.8689, lng: 127.5234, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNTA0MTJfNCAg%2FMDAxNzQ0NDE5Mjk0OTYw.fn4HafqE5sSTUZltcKdJLATsn8OWbjjQJmTNrtSQ9d8g.uwNOmb_Y6R3Qh_fkmzoGI8q9MlXyBwCAYdeZs6rFNUgg.JPEG%2F20250411_192517.jpg&type=sc960_832', likes: 198 },
      { id: 's26', name: 'ê²€ë´‰ì‚°', province: 'ê°•ì›íŠ¹ë³„ìì¹˜ë„', city: 'íƒœë°±ì‹œ', district: 'í™©ì§€ë™', detailAddress: 'ê²€ë´‰ì‚°ë¡œ', desc: 'ë´‰ìš°ë¦¬ ìœ„ì˜ ì¼ì¶œ í¬ì¸íŠ¸. ì˜ˆë¹„ íë§ ìŠ¤íŒŸì…ë‹ˆë‹¤.', tags: ['#ì¼ì¶œ','#ì‚°','#íƒœë°±'], lat: 37.1628, lng: 128.9881, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMzA4MDZfMzYg%2FMDAxNjkxMzI3MzQzMzc2.OnHKGWl9Joo1G2L6r4DtoX8A-0WikRH5MMEvgPwi8hAg.3c5kBpM2A6m_cb_yQ11vY5dsj47gfOrvQyDlUIVJgq0g.GIF.gustjsdl8%2Fvllo.gif&type=sc960_832_gif', likes: 134 },
      { id: 's27', name: 'íŒêµ ì¹´í˜ê±°ë¦¬', province: 'ê²½ê¸°ë„', city: 'ì„±ë‚¨ì‹œ', district: 'ë¶„ë‹¹êµ¬ ì‚¼í‰ë™', detailAddress: 'íŒêµì—­ë¡œ ì¼ëŒ€', desc: 'ê°ì„± ì¹´í˜ë“¤ì´ ëª¨ì—¬ìˆëŠ” ê±°ë¦¬. ì‚¬ì§„ ì°ê¸° ì¢‹ì€ ì¸í…Œë¦¬ì–´ ì¹´í˜ë“¤ì…ë‹ˆë‹¤.', tags: ['#ì¹´í˜','#ê°ì„±','#ë¶€ì²œ'], lat: 37.4919, lng: 127.1247, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDA0MDRfMTI0%2FMDAxNzEyMjE3MDcyMjAy.B5NEB1I1-AkjVPDZetbQuw99R8Tx7YJpxmg694Tiq6gg.jErMJ-uJdjAs02ChPI8u-pdyjbASOAPR2i6zb_pu3Y0g.JPEG%2FIMG_6349.jpg&type=sc960_832', likes: 167 },
      { id: 's28', name: 'ìœ ëª…ì‚° ë“±ì‚°ë¡œ', province: 'ê²½ê¸°ë„', city: 'ê°€í‰êµ°', district: 'ì„¤ì•…ë©´', detailAddress: 'ìœ ëª…ì‚°ê¸¸', desc: 'ìˆ² ì† íŠ¸ë ˆí‚¹ ì½”ìŠ¤. ìš´ë™í•˜ë©´ì„œ ì‚¬ì§„ë„ ë‚¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.', tags: ['#ìˆ²','#ê²¨ìš¸','#ë¹™ì‚°','#í­í¬'], lat: 37.4511, lng: 127.0661, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyNDAxMjdfMTMz%2FMDAxNzA2MjgxNzQ2NTk5.oncbOQnK_3Wg45erLghjpY9X51czILpmJL4KyH2HVDcg.rHOYJUpGb2VWWXB8Sria-WQN2skYQKUWRBLjo86j_n8g.JPEG.djjm92%2FIMG_0687.jpg&type=sc960_832', likes: 145 },
      { id: 's29', name: 'ëŒ€ë¶€ë°”ë‹¤í–¥ê¸°í…Œë§ˆíŒŒí¬', province: 'ê²½ê¸°ë„', city: 'ì•ˆì‚°ì‹œ', district: 'ë‹¨ì›êµ¬ ëŒ€ë¶€ë™', detailAddress: 'ëŒ€ë¶€í™©ê¸ˆë¡œ', desc: 'ì›í˜• ì•¼ì™¸ê³µê°„ì—ì„œ í•˜ëŠ˜ì„ ë°°ê²½ìœ¼ë¡œ í•œ ì‚¬ì§„ì´¬ì˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.', tags: ['#ì•¼ì™¸','#ê°ì„±','#ì•ˆì‚°'], lat: 37.2919, lng: 126.8308, img: 'https://postfiles.pstatic.net/MjAxNzAzMTNfMjYz/MDAxNDg5MzY4Nzc2MDQy.0tI4DSiABffq_wKx41j1IK_Y1qp0lLztC9XixAeNGUgg.1zxNELeHvXAZaxf3Qa3RupDFFhcxALYvpH9Vv2uQk-Ig.JPEG.minbakgajago/jaeeun93.jpg?type=w3840', likes: 178 },
      { id: 's30', name: 'í•œê°•ê³µì›', province: 'ê²½ê¸°ë„', city: 'êµ¬ë¦¬ì‹œ', district: 'í† í‰ë™', detailAddress: 'í•œê°•ëŒ€ë¡œ', desc: 'í•œê°•ë³€ ì‚°ì±…ê³¼ ì‚¬ì§„ì´¬ì˜ì„ ë™ì‹œì—. ê³„ì ˆë§ˆë‹¤ ë‹¤ë¥¸ ë§¤ë ¥ì…ë‹ˆë‹¤.', tags: ['#ê°•ë³€','#ê³µì›','#êµ¬ë¦¬'], lat: 37.6099, lng: 127.1289, img: 'https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2F20150518_127%2Fmarianz_1431912550400nNBPo_JPEG%2FIMG_6185.JPG&type=sc960_832', likes: 189 }
    ];

    // API ì„¤ì •
    // Codespaces í™˜ê²½ì—ì„œëŠ” í¬íŠ¸ í¬ì›Œë”© URL ì‚¬ìš©
    const getApiUrl = () => {
      // Codespaces í™˜ê²½ ê°ì§€
      if (window.location.hostname.includes('github.dev') || window.location.hostname.includes('githubpreview.dev')) {
        // í˜„ì¬ URLì˜ í˜¸ìŠ¤íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ API URL ìƒì„±
        const host = window.location.hostname.replace(/-8000\./, '-3000.');
        return `${window.location.protocol}//${host}/api`;
      }
      // ë¡œì»¬ ê°œë°œ í™˜ê²½
      return 'http://localhost:3000/api';
    };
    const API_URL = getApiUrl();
    console.log('ğŸ”§ API URL:', API_URL);
    
    // ì„¸ì…˜ë³„ í† í° ê´€ë¦¬ (ê° ë¸Œë¼ìš°ì € íƒ­/ì„¸ì…˜ë§ˆë‹¤ ë…ë¦½ì )
    let authToken = sessionStorage.getItem('currentAuthToken') || null;
    let currentUser = null;
    
    // authTokenì´ ìˆìœ¼ë©´ ë¨¼ì € ì‚¬ìš©ì ì •ë³´ ë³µì› ì‹œë„
    if (authToken) {
      try {
        const payload = JSON.parse(atob(authToken.split('.')[1]));
        currentUser = {
          id: payload.id,
          username: payload.username,
          nickname: payload.nickname,
          isAdmin: payload.isAdmin
        };
        console.log('ğŸ” ì„¸ì…˜ í† í°ìœ¼ë¡œ ì‚¬ìš©ì ë³µì›:', currentUser.nickname, `(ì„¸ì…˜ ID: ${payload.id})`);
      } catch (e) {
        console.error('í† í° íŒŒì‹± ì˜¤ë¥˜:', e);
        authToken = null;
        sessionStorage.removeItem('currentAuthToken');
      }
    }
    
    // ì‚¬ìš©ìë³„ localStorage í‚¤ ìƒì„± í•¨ìˆ˜ (ì˜êµ¬ ì €ì¥ìš©)
    function getUserStorageKey(userId, key) {
      return `user_${userId}_${key}`;
    }
    
    // ì„¸ì…˜ì— í† í° ì €ì¥ (í˜„ì¬ íƒ­/ì„¸ì…˜ì—ì„œë§Œ ìœ íš¨)
    function saveAuthToken(token, user) {
      authToken = token;
      currentUser = user;
      sessionStorage.setItem('currentAuthToken', token);
      // ì‚¬ìš©ìë³„ ì˜êµ¬ ì €ì¥ì†Œì—ë„ ì €ì¥ (ë‚˜ì¤‘ì— ë³µì›ìš©)
      localStorage.setItem(getUserStorageKey(user.id, 'authToken'), token);
      localStorage.setItem(getUserStorageKey(user.id, 'lastLogin'), new Date().toISOString());
      console.log(`âœ… ${user.nickname}ë‹˜ ë¡œê·¸ì¸ ì™„ë£Œ (ì„¸ì…˜ & ì˜êµ¬ì €ì¥)`);
    }
    
    // ë¡œê·¸ì•„ì›ƒ ì‹œ ì„¸ì…˜ ë° ì˜êµ¬ ì €ì¥ì†Œ ì •ë¦¬
    function clearAuthToken() {
      if (currentUser) {
        const userId = currentUser.id;
        localStorage.removeItem(getUserStorageKey(userId, 'authToken'));
        localStorage.removeItem(getUserStorageKey(userId, 'lastLogin'));
        console.log(`ğŸ—‘ï¸ ${currentUser.nickname}ë‹˜ ë°ì´í„° ì‚­ì œ`);
      }
      sessionStorage.removeItem('currentAuthToken');
      authToken = null;
      currentUser = null;
    }

    // GitHub Codespaces ê´€ë ¨ í•¨ìˆ˜ ì œê±°ë¨

    let spots = spotsData.map(s => ({
      ...s,
      comments: [],
      liked: false,
      province: s.province || '',
      city: s.city || '',
      district: s.district || '',
      detailAddress: s.detailAddress || '',
      address: s.address || '',
      placeName: s.placeName || '',
      mapImg: s.mapImg || '',
      author: null,
      authorId: null
    }));

    let currentSpot = null;
    let map = null;
    let mapMarkers = [];
    let galleryImages = [];
    let currentGalleryIndex = 0;
    let galleryTouchStartX = 0;
    let galleryTouchEndX = 0;

    // === ì¸ì¦ ê´€ë ¨ í•¨ìˆ˜ ===
    
    async function checkAuth() {
      // ì„¸ì…˜ì— ì €ì¥ëœ í† í°ì´ ìˆìœ¼ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš© (ì´ë¯¸ ë¡œê·¸ì¸ëœ ìƒíƒœ)
      if (authToken && currentUser) {
        console.log('ğŸ” ì„¸ì…˜ì—ì„œ ì‚¬ìš©ì ë³µì›:', currentUser.nickname);
        updateUserInfo(currentUser);
        return true;
      }

      // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ìƒíƒœ
      console.log('â„¹ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      updateUserInfo(null, true);
      return false;
    }

    function updateUserInfo(user, isError = false) {
      const userInfoDiv = document.getElementById('userInfo');
      if (user) {
        const avatarHTML = 'ğŸ‘¤';
        const adminBadge = user.isAdmin ? ' <span style="color: #f39c12;">ğŸ‘‘</span>' : '';
        userInfoDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px;">
            ${avatarHTML}
            <span><strong>${user.nickname}</strong>${adminBadge}ë‹˜</span>
            <button class="btn-logout" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
          </div>
        `;
      } else if (isError) {
        // ë¡œê·¸ì¸ í•„ìš”
        userInfoDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px; font-size: 14px;">
            <button class="btn-login" onclick="showLoginModal()">ë¡œê·¸ì¸</button>
            <button class="btn-login" onclick="showRegisterModal()">íšŒì›ê°€ì…</button>
          </div>
        `;
      } else {
        // ë¡œë”© ì¤‘
        userInfoDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px; font-size: 14px; color: #666;">
            <i class="fas fa-circle-notch fa-spin"></i>
            <span>ë¡œë”© ì¤‘...</span>
          </div>
        `;
      }
    }

    // === ë¡œê·¸ì¸/íšŒì›ê°€ì… ëª¨ë‹¬ í•¨ìˆ˜ ===

    function showLoginModal() {
      document.getElementById('loginModal').classList.add('active');
      document.getElementById('loginError').classList.remove('active');
      document.getElementById('loginUsername').value = '';
      document.getElementById('loginPassword').value = '';
    }

    function closeLoginModal() {
      document.getElementById('loginModal').classList.remove('active');
    }

    function showRegisterModal() {
      document.getElementById('registerModal').classList.add('active');
      document.getElementById('registerError').classList.remove('active');
      document.getElementById('registerUsername').value = '';
      document.getElementById('registerNickname').value = '';
      document.getElementById('registerPassword').value = '';
    }

    function closeRegisterModal() {
      document.getElementById('registerModal').classList.remove('active');
    }

    async function handleLogin(e) {
      e.preventDefault();
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;
      const errorDiv = document.getElementById('loginError');

      try {
        const response = await fetch(`${API_URL}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        const data = await response.json();

        if (response.ok) {
          saveAuthToken(data.token, data.user);
          updateUserInfo(currentUser);
          closeLoginModal();
          alert(`í™˜ì˜í•©ë‹ˆë‹¤, ${currentUser.nickname}ë‹˜!`);
          await loadSpotsFromServer();
        } else {
          errorDiv.textContent = data.error || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
          errorDiv.classList.add('active');
        }
      } catch (error) {
        console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
        errorDiv.textContent = 'ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        errorDiv.classList.add('active');
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      const username = document.getElementById('registerUsername').value.trim();
      const nickname = document.getElementById('registerNickname').value.trim();
      const password = document.getElementById('registerPassword').value;
      const errorDiv = document.getElementById('registerError');

      try {
        const response = await fetch(`${API_URL}/auth/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, nickname, password })
        });

        const data = await response.json();

        if (response.ok) {
          saveAuthToken(data.token, data.user);
          updateUserInfo(currentUser);
          closeRegisterModal();
          alert(`í™˜ì˜í•©ë‹ˆë‹¤, ${currentUser.nickname}ë‹˜! íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.`);
          await loadSpotsFromServer();
        } else {
          errorDiv.textContent = data.error || 'íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
          errorDiv.classList.add('active');
        }
      } catch (error) {
        console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
        errorDiv.textContent = 'ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
        errorDiv.classList.add('active');
      }
    }

    function handleLogout() {
      if (confirm('ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        clearAuthToken();
        updateUserInfo(null);
        alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ì‹œ ë¡œê·¸ì¸ë©ë‹ˆë‹¤.');
      }
    }

    // === ê´€ë¦¬ì ë¡œê·¸ì¸ í•¨ìˆ˜ ===

    function showAdminLoginModal() {
      document.getElementById('adminLoginModal').style.display = 'flex';
    }

    function closeAdminLoginModal() {
      document.getElementById('adminLoginModal').style.display = 'none';
      document.getElementById('adminUsername').value = '';
      document.getElementById('adminPassword').value = '';
    }

    async function adminLogin() {
      const username = document.getElementById('adminUsername').value.trim();
      const password = document.getElementById('adminPassword').value.trim();

      if (!username || !password) {
        alert('âš ï¸ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      try {
        const response = await fetch(`${API_URL}/auth/admin`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        const data = await response.json();

        if (response.ok) {
          saveAuthToken(data.token, data.user);
          updateUserInfo(currentUser);
          closeAdminLoginModal();
          alert(`ğŸ‘‘ ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ${currentUser.nickname}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);
        } else {
          alert(`âŒ ${data.error || 'ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}`);
        }
      } catch (error) {
        console.error('ê´€ë¦¬ì ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
        alert('âŒ ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    // === API í†µì‹  í•¨ìˆ˜ ===

    async function loadSpotsFromServer() {
      try {
        console.log('ğŸ”„ ì„œë²„ì—ì„œ í¬í† ìŠ¤íŒŸ ë¡œë”© ì¤‘...');
        const response = await fetch(`${API_URL}/spots`);
        const data = await response.json();
        console.log('ğŸ“¦ ì„œë²„ì—ì„œ ë°›ì€ í¬í† ìŠ¤íŒŸ:', data.spots?.length || 0, 'ê°œ');
        
        if (data.spots && data.spots.length > 0) {
          // ì„œë²„ì— ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì‚¬ìš©
          spots = data.spots;
          renderSpots();
          renderMap();
        } else {
          // ì„œë²„ì— ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ ë¡œì»¬ ë°ì´í„° ìœ ì§€
          console.log('â„¹ï¸ ì„œë²„ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¡œì»¬ ë°ì´í„° ì‚¬ìš©:', spots.length, 'ê°œ');
          renderSpots();
          renderMap();
        }
      } catch (error) {
        console.error('âŒ í¬í† ìŠ¤íŒŸ ë¡œë“œ ì‹¤íŒ¨:', error);
        // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡œì»¬ ë°ì´í„° ì‚¬ìš©
        console.log('â„¹ï¸ ë¡œì»¬ ë°ì´í„° ì‚¬ìš©:', spots.length, 'ê°œ');
        renderSpots();
        renderMap();
      }
    }

    function loadLocalData() {
      const saved = localStorage.getItem('photoSpotsData');
      if(saved) {
        const data = JSON.parse(saved);
        // ì´ì „ ë²„ì „ í˜¸í™˜: 'spotData' í˜•ì‹ì´ ìˆë‹¤ë©´ ê·¸ êµ¬ì¡°ë¥¼ ë³€í™˜
        if(data.spots && Array.isArray(data.spots)) {
          spots = data.spots.map(s => ({
            id: s.id,
            name: s.name || '',
            desc: s.desc || '',
            tags: Array.isArray(s.tags) ? s.tags : (s.tags ? String(s.tags).split(',') : []),
            lat: parseFloat(s.lat) || 0,
            lng: parseFloat(s.lng) || 0,
            img: s.img || '',
            comments: Array.isArray(s.comments) ? s.comments : [],
            liked: !!s.liked,
            likes: typeof s.likes === 'number' ? s.likes : (s.likes ? parseInt(s.likes) : 0),
            province: s.province || '',
            city: s.city || '',
            district: s.district || '',
            detailAddress: s.detailAddress || '',
            address: s.address || '',
            placeName: s.placeName || '',
            mapImg: s.mapImg || ''
          }));
        } else if(data.spotData && Array.isArray(data.spotData)) {
          // ì´ì „ í¬ë§· í˜¸í™˜: spotDataì—ëŠ” ì¼ë¶€ í•„ë“œë§Œ ì €ì¥ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŒ
          const savedArr = data.spotData;
          spots.forEach(s => {
            const found = savedArr.find(d => d.id === s.id);
            if(found) {
              s.comments = found.comments || [];
              s.liked = found.liked || false;
            }
          });
        }
      }
    }

    function saveLocalData() {
      // ì „ì²´ ìŠ¤íŒŸ ìƒíƒœë¥¼ ì €ì¥í•©ë‹ˆë‹¤ (ì´ë¦„, ì„¤ëª…, ì¢Œí‘œ, ì´ë¯¸ì§€, íƒœê·¸, ì¢‹ì•„ìš”, ëŒ“ê¸€ ë“±)
      const dataToSave = {
        spots: spots.map(s => ({
          id: s.id,
          name: s.name,
          desc: s.desc,
          tags: s.tags,
          lat: s.lat,
          lng: s.lng,
          img: s.img,
          comments: s.comments || [],
          liked: !!s.liked,
          likes: typeof s.likes === 'number' ? s.likes : 0,
          province: s.province || '',
          city: s.city || '',
          district: s.district || '',
          detailAddress: s.detailAddress || '',
          address: s.address || '',
          placeName: s.placeName || '',
          mapImg: s.mapImg || ''
        }))
      };
      localStorage.setItem('photoSpotsData', JSON.stringify(dataToSave));
    }

    function switchView(view, src) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById(view + 'View').classList.add('active');
      // íƒ­ í™œì„±í™”: srcê°€ ì—˜ë¦¬ë¨¼íŠ¸ì´ë©´ ê·¸ëŒ€ë¡œ, ì•„ë‹ˆë©´ IDë¡œ ë³´ì¡° ì²˜ë¦¬
      document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));
      if (src && src.classList) {
        src.classList.add('active');
      } else {
        const byId = document.getElementById(`tab-${view}`);
        if (byId) byId.classList.add('active');
      }

      if(view === 'favorite') renderFavorites();
      if(view === 'map') {
        // ì§€ë„ íƒ­ìœ¼ë¡œ ì „í™˜ ì‹œ ì§€ë„ ë Œë”ë§
        setTimeout(() => renderMapView(), 100);
      }
      if(view === 'admin') {
        // editingSpotIdê°€ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°ì—ë§Œ í¼ ìˆ¨ê¹€
        if (!editingSpotId) {
          document.getElementById('adminForm').style.display = 'none';
        }
      }
    }

    function renderSpots(spotsToRender = spots) {
      const grid = document.getElementById('spotsGrid');
      if(spotsToRender.length === 0) {
        grid.innerHTML = '<div class="empty-state" style="grid-column: 1 / -1;"><div class="empty-state-icon">ğŸ”</div><p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';
        return;
      }

      grid.innerHTML = spotsToRender.map(s => {
        const locationText = [s.province, s.city].filter(Boolean).join(' ');
        const authorText = s.author ? `ğŸ‘¤ ${s.author.nickname}` : '';
        return `
        <div class="spot-card" onclick="showDetail('${s.id}')">
          <img src="${s.img}" alt="${s.name}" class="spot-card-image">
          <div class="spot-card-content">
            <div class="spot-card-title">${s.name}</div>
            ${locationText ? `<div style="font-size: 12px; color: #666; margin-bottom: 4px;">ğŸ“ ${locationText}</div>` : ''}
            ${authorText ? `<div style="font-size: 11px; color: #888; margin-bottom: 8px;">${authorText}</div>` : ''}
            <div class="spot-card-desc">${s.desc.substring(0, 60)}...</div>
            <div class="spot-card-tags">
              ${s.tags.slice(0, 2).map(t => `<span class="tag">${t}</span>`).join('')}
            </div>
            <div class="spot-card-footer">
              <div class="spot-card-stats">
                <span>â¤ï¸ ${s.likes}</span>
                <span>ğŸ’¬ ${s.comments.length}</span>
              </div>
            </div>
          </div>
        </div>
      `;
      }).join('');
    }

    function showDetail(spotId) {
      currentSpot = spots.find(s => s.id === spotId);
      if(!currentSpot) return;

      document.getElementById('detailTitle').textContent = currentSpot.name;
      
      // ì£¼ì†Œ ì •ë³´ ë° ì‘ì„±ì ì •ë³´ í‘œì‹œ
      const locationParts = [currentSpot.province, currentSpot.city, currentSpot.detailAddress].filter(Boolean);
      let locationHTML = locationParts.length > 0 ? 'ğŸ“ ' + locationParts.join(' ') : '';
      if (currentSpot.author) {
        locationHTML += `<br><small style="color: #888;">ğŸ‘¤ ${currentSpot.author.nickname}</small>`;
      }
      
      document.getElementById('detailLocation').innerHTML = locationHTML;
      
      // ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€ ê²°ì • (ì‘ì„±ì ë˜ëŠ” ê´€ë¦¬ì)
      const editBtn = document.getElementById('editSpotBtn');
      const deleteBtn = document.getElementById('deleteSpotBtn');
      if (currentUser && (currentSpot.authorId === currentUser.id || currentUser.isAdmin)) {
        editBtn.style.display = 'block';
        deleteBtn.style.display = 'block';
      } else {
        editBtn.style.display = 'none';
        deleteBtn.style.display = 'none';
      }
      
      document.getElementById('detailImage').src = currentSpot.img;
      document.getElementById('detailDesc').textContent = currentSpot.desc;
      document.getElementById('detailTags').innerHTML = currentSpot.tags.map(t => `<span class="tag">${t}</span>`).join(' ');

      document.getElementById('likeCount').textContent = currentSpot.likes;
      document.getElementById('commentCount').textContent = currentSpot.comments.length;
      document.getElementById('actionCommentCount').textContent = currentSpot.comments.length;
      document.getElementById('likeBtn').classList.toggle('liked', currentSpot.liked);

      // ê°¤ëŸ¬ë¦¬ ë¡œë“œ (ì„œë²„ì—ì„œ)
      galleryImages = currentSpot.gallery || [];
      currentGalleryIndex = 0;
      updateGallery();

      renderComments();
      
      // ê·¼ì²˜ ìˆ™ë°•ì—…ì†Œ ê²€ìƒ‰
      searchNearbyAccommodations(currentSpot);
      
      // ê·¼ì²˜ ë§›ì§‘ ê²€ìƒ‰
      searchNearbyRestaurants(currentSpot);

      const detailView = document.getElementById('detailView');
      detailView.classList.add('active');
      document.querySelectorAll('.view').forEach(v => v !== detailView && v.classList.remove('active'));
      document.querySelectorAll('.nav-tabs button').forEach(b => b.classList.remove('active'));

      updateMapButton();
    }

    function toggleEditMode() {
      if (!currentSpot) return;
      
      // ê¶Œí•œ í™•ì¸ (ì‘ì„±ì ë˜ëŠ” ê´€ë¦¬ì)
      if (!currentUser || (currentSpot.authorId !== currentUser.id && !currentUser.isAdmin)) {
        alert('âŒ ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const editForm = document.getElementById('inlineEditForm');
      const editBtn = document.getElementById('editSpotBtn');
      
      if (editForm.style.display === 'none') {
        // ìˆ˜ì • ëª¨ë“œ í™œì„±í™”
        editForm.style.display = 'block';
        editBtn.innerHTML = '<i class="fas fa-times"></i> ì·¨ì†Œ';
        
        // í˜„ì¬ ë°ì´í„°ë¥¼ í¼ì— ë¡œë“œ
        document.getElementById('inlineEditName').value = currentSpot.name || '';
        document.getElementById('inlineEditProvince').value = currentSpot.province || '';
        
        // ë„ì‹œ ì˜µì…˜ ì—…ë°ì´íŠ¸
        updateInlineEditCitySelect();
        document.getElementById('inlineEditCity').value = currentSpot.city || '';
        
        const fullAddress = [currentSpot.district, currentSpot.detailAddress].filter(x => x).join(' ');
        document.getElementById('inlineEditDetailAddress').value = fullAddress;
        document.getElementById('inlineEditDesc').value = currentSpot.desc || '';
        document.getElementById('inlineEditTags').value = (currentSpot.tags || []).join(',');
        document.getElementById('inlineEditImg').value = currentSpot.img || '';
        
        // í¼ìœ¼ë¡œ ìŠ¤í¬ë¡¤
        editForm.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      } else {
        // ìˆ˜ì • ëª¨ë“œ ë¹„í™œì„±í™”
        cancelInlineEdit();
      }
    }

    function updateInlineEditCitySelect() {
      const provinceValue = document.getElementById('inlineEditProvince').value;
      const citySelect = document.getElementById('inlineEditCity');
      
      citySelect.innerHTML = '<option value="">ì„ íƒ</option>';
      
      if (provinceValue && koreanRegions[provinceValue]) {
        koreanRegions[provinceValue].forEach(city => {
          citySelect.innerHTML += `<option value="${city}">${city}</option>`;
        });
      }
    }

    function cancelInlineEdit() {
      document.getElementById('inlineEditForm').style.display = 'none';
      document.getElementById('editSpotBtn').innerHTML = '<i class="fas fa-edit"></i> ìˆ˜ì •';
    }

    async function saveInlineEdit() {
      if (!currentSpot || !currentUser) return;
      
      // ê¶Œí•œ ì¬í™•ì¸
      if (currentSpot.authorId !== currentUser.id && !currentUser.isAdmin) {
        alert('âŒ ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const updateData = {
        name: document.getElementById('inlineEditName').value.trim(),
        province: document.getElementById('inlineEditProvince').value.trim(),
        city: document.getElementById('inlineEditCity').value.trim(),
        district: '',
        detailAddress: document.getElementById('inlineEditDetailAddress').value.trim(),
        desc: document.getElementById('inlineEditDesc').value.trim(),
        tags: document.getElementById('inlineEditTags').value.split(',').map(t => t.trim()).filter(t => t),
        img: document.getElementById('inlineEditImg').value.trim(),
        lat: currentSpot.lat,
        lng: currentSpot.lng
      };
      
      if (!updateData.name || !updateData.province || !updateData.city || !updateData.desc) {
        alert('âš ï¸ í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      try {
        // ê¸°ì¡´ ê²Œì‹œê¸€ ìˆ˜ì • (í•­ìƒ PUT ì‚¬ìš©)
        const url = `${API_URL}/spots/${currentSpot.id}`;
        const method = 'PUT';

        const response = await fetch(url, {
          method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify(updateData)
        });

        const data = await response.json();

        if (response.ok) {
          alert(`âœ… "${updateData.name}" ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`);
          
          // ë¡œì»¬ spots ë°°ì—´ì—ì„œ í•´ë‹¹ í¬í† ìŠ¤íŒŸ ì—…ë°ì´íŠ¸
          const spotIndex = spots.findIndex(s => s.id === currentSpot.id);
          if (spotIndex !== -1) {
            spots[spotIndex] = {
              ...spots[spotIndex],
              ...updateData,
              author: data.spot?.author || currentSpot.author
            };
          }
          
          cancelInlineEdit();
          renderSpots();
          // ì—…ë°ì´íŠ¸ëœ ë°ì´í„°ë¡œ ìƒì„¸ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
          showDetail(currentSpot.id);
        } else {
          alert(`âŒ ${data.error || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}`);
        }
      } catch (error) {
        console.error('ì €ì¥ ì˜¤ë¥˜:', error);
        alert('âŒ ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function deleteCurrentSpotInline() {
      if (!currentSpot || !currentUser) return;
      
      // ê¶Œí•œ í™•ì¸
      if (currentSpot.authorId !== currentUser.id && !currentUser.isAdmin) {
        alert('âŒ ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      if (!confirm(`"${currentSpot.name}"ì„(ë¥¼) ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        return;
      }
      
      try {
        const response = await fetch(`${API_URL}/spots/${currentSpot.id}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${authToken}`
          }
        });

        const data = await response.json();

        if (response.ok) {
          alert('âœ… í¬í† ìŠ¤íŒŸì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          
          // ë¡œì»¬ spots ë°°ì—´ì—ì„œ í•´ë‹¹ í¬í† ìŠ¤íŒŸ ì œê±°
          const spotIndex = spots.findIndex(s => s.id === currentSpot.id);
          if (spotIndex !== -1) {
            spots.splice(spotIndex, 1);
          }
          
          renderSpots();
          switchView('list');
        } else {
          alert(`âŒ ${data.error || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}`);
        }
      } catch (error) {
        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('âŒ ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function deleteCurrentSpot() {
      if (!currentSpot) return;
      editingSpotId = currentSpot.id;
      await deleteSpot();
      if (spots.find(s => s.id === currentSpot.id)) {
        // ì‚­ì œ ì‹¤íŒ¨
        return;
      }
      // ì‚­ì œ ì„±ê³µ ì‹œ ëª©ë¡ìœ¼ë¡œ ì´ë™
      switchView('list');
    }

    function renderComments() {
      const list = document.getElementById('commentsList');
      document.getElementById('totalComments').textContent = currentSpot.comments.length;
      
      if(currentSpot.comments.length === 0) {
        list.innerHTML = '<div class="empty-state"><p>ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p></div>';
        return;
      }

      list.innerHTML = currentSpot.comments.map((c, idx) => `
        <div class="comment-item">
          <div class="comment-author">${c.author}</div>
          <div class="comment-text">${c.text}</div>
          <div class="comment-date">${new Date(c.date).toLocaleDateString('ko-KR')}</div>
          <button class="comment-delete" onclick="deleteComment(${idx})">ì‚­ì œ</button>
        </div>
      `).join('');
    }

    function addComment() {
      const input = document.getElementById('commentInput');
      const text = input.value.trim();
      if(!text) return;

      currentSpot.comments.push({
        author: 'ìµëª… ì‚¬ìš©ì',
        text: text,
        date: new Date().toISOString()
      });

      input.value = '';
      renderComments();
      document.getElementById('commentCount').textContent = currentSpot.comments.length;
      document.getElementById('actionCommentCount').textContent = currentSpot.comments.length;
      saveLocalData();
    }

    function deleteComment(idx) {
      currentSpot.comments.splice(idx, 1);
      renderComments();
      document.getElementById('commentCount').textContent = currentSpot.comments.length;
      document.getElementById('actionCommentCount').textContent = currentSpot.comments.length;
      saveLocalData();
    }

    function toggleLike() {
      currentSpot.liked = !currentSpot.liked;
      if(currentSpot.liked) currentSpot.likes++;
      else currentSpot.likes--;
      
      document.getElementById('likeBtn').classList.toggle('liked');
      document.getElementById('likeCount').textContent = currentSpot.likes;
      
      saveLocalData();
    }

    async function onFileSelected(e) {
      const files = e.target.files;
      if(!files || files.length === 0) return;

      if (!currentSpot || !authToken) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }

      const newImages = [];
      let processed = 0;

      // íŒŒì¼ë“¤ì„ ì½ì–´ì„œ base64ë¡œ ë³€í™˜
      Array.from(files).forEach(file => {
        const reader = new FileReader();
        reader.onload = async (evt) => {
          newImages.push(evt.target.result);
          processed++;

          // ëª¨ë“  íŒŒì¼ ì²˜ë¦¬ ì™„ë£Œ
          if (processed === files.length) {
            try {
              const response = await fetch(`${API_URL}/spots/${currentSpot.id}/gallery`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({ images: newImages })
              });

              const data = await response.json();
              if (response.ok) {
                galleryImages = data.gallery;
                currentSpot.gallery = data.gallery;
                updateGallery();
                alert(`${files.length}ê°œì˜ ì‚¬ì§„ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`);
              } else {
                alert('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (data.error || 'ì„œë²„ ì˜¤ë¥˜'));
              }
            } catch (error) {
              console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
              alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
          }
        };
        reader.readAsDataURL(file);
      });

      e.target.value = '';
    }

    // ê°¤ëŸ¬ë¦¬ ì—…ë°ì´íŠ¸
    function updateGallery() {
      const gallery = document.getElementById('photoGallery');
      const container = document.getElementById('galleryContainer');
      const indicators = document.getElementById('galleryIndicators');
      const counter = document.getElementById('galleryCounter');
      const prevBtn = document.querySelector('.gallery-nav.prev');
      const nextBtn = document.querySelector('.gallery-nav.next');
      const deleteBtn = document.querySelector('.gallery-delete-btn');

      if (galleryImages.length === 0) {
        gallery.style.display = 'none';
        return;
      }

      gallery.style.display = 'block';

      // ìŠ¬ë¼ì´ë“œ ìƒì„±
      container.innerHTML = galleryImages.map((img, idx) => `
        <div class="gallery-slide">
          <img src="${img}" alt="Photo ${idx + 1}">
        </div>
      `).join('');

      // ì¸ë””ì¼€ì´í„° ìƒì„±
      indicators.innerHTML = galleryImages.map((_, idx) => `
        <div class="gallery-indicator ${idx === currentGalleryIndex ? 'active' : ''}" onclick="goToGallerySlide(${idx})"></div>
      `).join('');

      // ì¹´ìš´í„° ì—…ë°ì´íŠ¸
      counter.textContent = `${currentGalleryIndex + 1} / ${galleryImages.length}`;

      // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í‘œì‹œ
      prevBtn.style.display = galleryImages.length > 1 ? 'flex' : 'none';
      nextBtn.style.display = galleryImages.length > 1 ? 'flex' : 'none';
      deleteBtn.style.display = galleryImages.length > 0 ? 'flex' : 'none';

      // í˜„ì¬ ìŠ¬ë¼ì´ë“œë¡œ ì´ë™
      container.style.transform = `translateX(-${currentGalleryIndex * 100}%)`;

      // í„°ì¹˜ ì´ë²¤íŠ¸ ë“±ë¡
      setupGalleryTouch();
    }

    // ê°¤ëŸ¬ë¦¬ í„°ì¹˜ ì´ë²¤íŠ¸
    function setupGalleryTouch() {
      const container = document.getElementById('galleryContainer');
      
      container.addEventListener('touchstart', (e) => {
        galleryTouchStartX = e.changedTouches[0].screenX;
      }, { passive: true });

      container.addEventListener('touchend', (e) => {
        galleryTouchEndX = e.changedTouches[0].screenX;
        handleGallerySwipe();
      }, { passive: true });
    }

    function handleGallerySwipe() {
      const swipeThreshold = 50;
      const diff = galleryTouchStartX - galleryTouchEndX;

      if (Math.abs(diff) > swipeThreshold) {
        if (diff > 0) {
          galleryNext();
        } else {
          galleryPrev();
        }
      }
    }

    function galleryPrev() {
      if (currentGalleryIndex > 0) {
        currentGalleryIndex--;
        updateGallery();
      }
    }

    function galleryNext() {
      if (currentGalleryIndex < galleryImages.length - 1) {
        currentGalleryIndex++;
        updateGallery();
      }
    }

    function goToGallerySlide(index) {
      currentGalleryIndex = index;
      updateGallery();
    }

    async function deleteCurrentGalleryImage() {
      if (galleryImages.length === 0) return;
      
      if (!currentSpot || !authToken) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
      }

      if (confirm('ì´ ì‚¬ì§„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        try {
          const response = await fetch(`${API_URL}/spots/${currentSpot.id}/gallery/${currentGalleryIndex}`, {
            method: 'DELETE',
            headers: {
              'Authorization': `Bearer ${authToken}`
            }
          });

          const data = await response.json();
          if (response.ok) {
            galleryImages = data.gallery;
            currentSpot.gallery = data.gallery;
            
            // ì¸ë±ìŠ¤ ì¡°ì •
            if (currentGalleryIndex >= galleryImages.length && currentGalleryIndex > 0) {
              currentGalleryIndex--;
            }
            
            updateGallery();
            
            if (galleryImages.length === 0) {
              alert('ëª¨ë“  ì‚¬ì§„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          } else {
            alert('ì‚­ì œ ì‹¤íŒ¨: ' + (data.error || 'ì„œë²„ ì˜¤ë¥˜'));
          }
        } catch (error) {
          console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
          alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      }
    }

    // ëª©ë¡ í˜ì´ì§€ í•„í„° í•¨ìˆ˜
    function applyFilters() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const provinceFilter = document.getElementById('filterProvince').value;
      const cityFilter = document.getElementById('filterCity').value;
      const districtFilter = document.getElementById('filterDistrict').value;

      let filtered = spots.filter(s => {
        const matchSearch = !search || s.name.toLowerCase().includes(search) || s.desc.toLowerCase().includes(search);
        const matchProvince = !provinceFilter || s.province === provinceFilter;
        const matchCity = !cityFilter || s.city === cityFilter;
        return matchSearch && matchProvince && matchCity;
      });

      renderSpots(filtered);
      
      // ê´‘ì—­ì‹œ/ë„ ì„ íƒ ì‹œ ì‹œ/êµ°/êµ¬ ì˜µì…˜ ì—…ë°ì´íŠ¸
      updateCityOptions();
    }
    
    // í•„í„° ëŒ€ë¶„ë¥˜ ë³€ê²½ ì‹œ ì¤‘ë¶„ë¥˜ ì—…ë°ì´íŠ¸
    function updateFilterCitySelect() {
      const provinceSelect = document.getElementById('filterProvince');
      const citySelect = document.getElementById('filterCity');
      const provinceValue = provinceSelect.value;
      
      citySelect.innerHTML = '<option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>';
      
      if (provinceValue && koreanRegions[provinceValue]) {
        koreanRegions[provinceValue].forEach(city => {
          citySelect.innerHTML += `<option value="${city}">${city}</option>`;
        });
      }
      
      applyFilters();
    }
    
    function updateCityOptions() {
      // ì´ í•¨ìˆ˜ëŠ” ë” ì´ìƒ ì‚¬ìš©í•˜ì§€ ì•Šì§€ë§Œ í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€
      updateFilterCitySelect();
    }
    
    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
    document.getElementById('searchInput').addEventListener('input', applyFilters);

    function renderFavorites() {
      const favorited = spots.filter(s => s.liked);
      const grid = document.getElementById('favoriteGrid');
      
      if(favorited.length === 0) {
        grid.innerHTML = '<div class="empty-state" style="grid-column: 1 / -1;"><div class="empty-state-icon">â¤ï¸</div><p>ì•„ì§ ì¢‹ì•„ìš”í•œ í¬í† ì¡´ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
        return;
      }

      grid.innerHTML = favorited.map(s => {
        const locationText = [s.province, s.city].filter(Boolean).join(' ');
        return `
        <div class="spot-card" onclick="showDetail('${s.id}')">
          <img src="${s.img}" alt="${s.name}" class="spot-card-image">
          <div class="spot-card-content">
            <div class="spot-card-title">${s.name}</div>
            ${locationText ? `<div style="font-size: 12px; color: #666; margin-bottom: 8px;">ğŸ“ ${locationText}</div>` : ''}
            <div class="spot-card-desc">${s.desc.substring(0, 60)}...</div>
            <div class="spot-card-tags">
              ${s.tags.slice(0, 2).map(t => `<span class="tag">${t}</span>`).join('')}
            </div>
          </div>
        </div>
      `;
      }).join('');
    }

    function shareSpot() {
      const url = `http://127.0.0.1:8000/preview/index.html?spot=${currentSpot.id}`;
      alert(`ê³µìœ  ë§í¬:\n${url}`);
    }

    function openMapDirection() {
      const name = encodeURIComponent((currentSpot.placeName && currentSpot.placeName.trim()) || currentSpot.name || 'ëª©ì ì§€');
      const dlat = currentSpot.lat;
      const dlng = currentSpot.lng;
      // ë„¤ì´ë²„ ì§€ë„ ê¸¸ì°¾ê¸°(ì›¹) ëª©ì ì§€ ì¤‘ì‹¬ìœ¼ë¡œ ì—´ê¸°. ì‹œì‘ì ì€ ë¹„ì›Œë‘ê³  ëª©ì ì§€ë§Œ ì±„ì›€.
      const directionsUrl = `https://map.naver.com/v5/directions//${dlat},${dlng},${name}`;
      window.open(directionsUrl, '_blank');
    }

    // ì§€ë„ í•„í„° í•¨ìˆ˜ë“¤ ì œê±°ë¨ (í•„í„° ê¸°ëŠ¥ ì‚­ì œ)
    
    function renderMapView() {
      // Leaflet ì§€ë„ ì´ˆê¸°í™”
      const container = document.getElementById('mapContainer');
      if(!container) {
        console.error('âŒ ì§€ë„ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
        return;
      }
      
      console.log('ğŸ—ºï¸ ì§€ë„ ë Œë”ë§ ì‹œì‘...');
      
      // ê¸°ì¡´ ì§€ë„ê°€ ìˆìœ¼ë©´ ì œê±°
      if(map) {
        map.remove();
        map = null;
      }
      
      // ëª¨ë“  í¬í† ìŠ¤íŒŸ í‘œì‹œ (í•„í„°ë§ ì—†ìŒ)
      let filteredSpots = spots;
      console.log('ğŸ“ í‘œì‹œí•  í¬í† ìŠ¤íŒŸ ê°œìˆ˜:', filteredSpots.length);
      
      // ì§€ë„ ì´ˆê¸°í™” (í•œêµ­ ì¤‘ì‹¬ ì¢Œí‘œ)
      try {
        map = L.map('mapContainer').setView([36.5, 127.5], 7);
        console.log('âœ… ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ');
        
        // ì§€ë„ í¬ê¸° ì¬ì¡°ì • (íƒ­ ì „í™˜ ì‹œ í•„ìš”)
        setTimeout(() => {
          if(map) map.invalidateSize();
        }, 100);
      } catch (error) {
        console.error('âŒ ì§€ë„ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
        return;
      }
      
      // OpenStreetMap íƒ€ì¼ ë ˆì´ì–´ ì¶”ê°€
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        maxZoom: 18,
        minZoom: 6
      }).addTo(map);
      
      // í•„í„°ë§ëœ í¬í† ìŠ¤íŒŸì— ë§ˆì»¤ ì¶”ê°€
      let markerCount = 0;
      filteredSpots.forEach(spot => {
        if(spot.lat && spot.lng) {
          // ì»¤ìŠ¤í…€ ì•„ì´ì½˜ ìƒì„±
          const icon = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background:var(--primary);width:30px;height:30px;border-radius:50%;border:3px solid white;box-shadow:0 2px 8px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;"><i class="fas fa-camera" style="color:white;font-size:14px;"></i></div>',
            iconSize: [30, 30],
            iconAnchor: [15, 15]
          });
          
          // ë§ˆì»¤ ìƒì„±
          const marker = L.marker([spot.lat, spot.lng], { icon: icon }).addTo(map);
          markerCount++;
          
          // íŒì—… ë‚´ìš© ìƒì„±
          const popupContent = `
            <div>
              <div class="popup-title">${spot.name}</div>
              <div class="popup-desc">${spot.desc}</div>
              <div class="popup-tags">
                ${spot.tags.map(tag => `<span class="popup-tag">${tag}</span>`).join('')}
              </div>
              <button class="popup-button" onclick="showDetail('${spot.id}')">
                ìì„¸íˆ ë³´ê¸°
              </button>
            </div>
          `;
          
          marker.bindPopup(popupContent, {
            maxWidth: 250,
            className: 'custom-popup'
          });
          
          // ë§ˆì»¤ì— í˜¸ë²„ íš¨ê³¼
          marker.on('mouseover', function() {
            this.openPopup();
          });
        }
      });
      
      console.log('ğŸ“ ë§ˆì»¤ ì¶”ê°€ ì™„ë£Œ:', markerCount, 'ê°œ');
      
      // ëª¨ë“  ë§ˆì»¤ê°€ ë³´ì´ë„ë¡ ì§€ë„ ë²”ìœ„ ì¡°ì •
      const validSpots = filteredSpots.filter(s => s.lat && s.lng);
      if(validSpots.length > 0) {
        const bounds = L.latLngBounds(validSpots.map(s => [s.lat, s.lng]));
        map.fitBounds(bounds, { padding: [50, 50] });
        console.log('âœ… ì§€ë„ ë²”ìœ„ ì¡°ì • ì™„ë£Œ');
      } else {
        console.warn('âš ï¸ ì¢Œí‘œê°€ ìˆëŠ” í¬í† ìŠ¤íŒŸì´ ì—†ìŠµë‹ˆë‹¤');
      }
    }

    function updateMapButton() {
      // ì§€ë„ ë²„íŠ¼ì€ í•­ìƒ í™œì„±í™” (ì¢Œí‘œê°€ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ Static Map ìƒì„±)
      const btn = document.getElementById('detailMapBtn');
      if(!btn || !currentSpot) return;
      
      btn.style.opacity = '1';
      btn.style.cursor = 'pointer';
      btn.disabled = false;
    }

    function showMapImage() {
      if(!currentSpot) return;
      
      // ë„¤ì´ë²„ ì§€ë„ë¡œ ë°”ë¡œ ì—°ë™
      const name = encodeURIComponent(currentSpot.placeName || currentSpot.name || 'ëª©ì ì§€');
      const lat = currentSpot.lat || 37.5665;
      const lng = currentSpot.lng || 126.9780;
      
      // ë„¤ì´ë²„ ì§€ë„ ê²€ìƒ‰ ê²°ê³¼ë¡œ ì—´ê¸°
      const naverMapUrl = `https://map.naver.com/v5/search/${name}?c=${lng},${lat},15,0,0,0,dh`;
      window.open(naverMapUrl, '_blank');
    }

    function closeMapModal(event) {
      if(!event || event.target.id === 'mapModal' || event.target.className === 'map-modal-close') {
        document.getElementById('mapModal').classList.remove('active');
      }
    }

    let editingSpotId = null;

    function initAdminForm() {
      const select = document.getElementById('adminSelect');
      select.innerHTML = '<option value="">í¬í† ìŠ¤íŒŸ ì„ íƒ</option>' +
        spots.map(s => `<option value="${s.id}">${s.name}</option>`).join('');
      
      select.addEventListener('change', (e) => {
        if(e.target.value) {
          loadSpotForEdit(e.target.value);
        } else {
          document.getElementById('adminForm').style.display = 'none';
        }
      });
    }

    function loadSpotForEdit(spotId) {
      const spot = spots.find(s => s.id === spotId);
      if(!spot) {
        console.error('Spot not found:', spotId);
        return;
      }

      console.log('Loading spot:', spot);
      editingSpotId = spotId;
      
      document.getElementById('editName').value = spot.name || '';
      document.getElementById('editProvince').value = spot.province || '';
      
      // ëŒ€ë¶„ë¥˜ ì„ íƒ í›„ ì¤‘ë¶„ë¥˜ ì˜µì…˜ ì—…ë°ì´íŠ¸
      updateEditCitySelect();
      
      // ì¤‘ë¶„ë¥˜ ê°’ ì„¤ì •
      const citySelect = document.getElementById('editCity');
      if(spot.city) {
        citySelect.value = spot.city;
      }
      
      // districtì™€ detailAddress í•©ì³ì„œ í‘œì‹œ
      const fullAddress = [spot.district, spot.detailAddress].filter(x => x).join(' ');
      document.getElementById('editDetailAddress').value = fullAddress;
      document.getElementById('editDesc').value = spot.desc || '';
      document.getElementById('editTags').value = (spot.tags || []).join(',');
      document.getElementById('editImg').value = spot.img || '';
      document.getElementById('adminForm').style.display = 'block';
      
      console.log('Form loaded successfully');
    }
    
    // ê´€ë¦¬ í˜ì´ì§€: ëŒ€ë¶„ë¥˜ ì„ íƒ ì‹œ ì¤‘ë¶„ë¥˜ ì˜µì…˜ ì—…ë°ì´íŠ¸
    function updateEditCitySelect() {
      const provinceValue = document.getElementById('editProvince').value;
      const citySelect = document.getElementById('editCity');
      
      // ì˜µì…˜ ì—…ë°ì´íŠ¸
      const currentCity = citySelect.value;
      citySelect.innerHTML = '<option value="">ì„ íƒ</option>';
      
      if(provinceValue && koreanRegions[provinceValue]) {
        koreanRegions[provinceValue].forEach(city => {
          citySelect.innerHTML += `<option value="${city}">${city}</option>`;
        });
      }
      
      // ê¸°ì¡´ ê°’ì´ ìˆìœ¼ë©´ ìœ ì§€
      if(currentCity && koreanRegions[provinceValue]?.includes(currentCity)) {
        citySelect.value = currentCity;
      }
    }
    
    async function saveEditData() {
      if(!editingSpotId) return;

      // ë¡œê·¸ì¸ í™•ì¸
      if (!authToken || !currentUser) {
        alert('âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        showLoginModal();
        return;
      }

      const spot = spots.find(s => s.id === editingSpotId);
      if(!spot) return;

      // ìƒˆ í¬í† ìŠ¤íŒŸì´ ì•„ë‹Œ ê²½ìš° ê¶Œí•œ í™•ì¸ (ê´€ë¦¬ìëŠ” ëª¨ë“  ìŠ¤íŒŸ ìˆ˜ì • ê°€ëŠ¥)
      if (spot.authorId && spot.authorId !== currentUser.id && !currentUser.isAdmin) {
        alert('âŒ ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë³¸ì¸ì´ ì‘ì„±í•œ í¬í† ìŠ¤íŒŸë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
      }

      // ë°ì´í„° ì¤€ë¹„
      const updateData = {
        name: document.getElementById('editName').value.trim(),
        province: document.getElementById('editProvince').value.trim(),
        city: document.getElementById('editCity').value.trim(),
        district: '',
        detailAddress: document.getElementById('editDetailAddress').value.trim(),
        desc: document.getElementById('editDesc').value.trim(),
        tags: document.getElementById('editTags').value.split(',').map(t => t.trim()).filter(t => t),
        img: document.getElementById('editImg').value.trim(),
        lat: spot.lat,
        lng: spot.lng
      };

      try {
        const url = spot.authorId ? `${API_URL}/spots/${editingSpotId}` : `${API_URL}/spots`;
        const method = spot.authorId ? 'PUT' : 'POST';

        const response = await fetch(url, {
          method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify(updateData)
        });

        const data = await response.json();

        if (response.ok) {
          alert(`âœ… "${updateData.name}" ì •ë³´ê°€ ${spot.authorId ? 'ìˆ˜ì •' : 'ì¶”ê°€'}ë˜ì—ˆìŠµë‹ˆë‹¤!`);
          
          if (spot.authorId) {
            // ê¸°ì¡´ í¬í† ìŠ¤íŒŸ ìˆ˜ì •
            const spotIndex = spots.findIndex(s => s.id === editingSpotId);
            if (spotIndex !== -1) {
              spots[spotIndex] = {
                ...spots[spotIndex],
                ...updateData,
                author: data.spot?.author || spots[spotIndex].author
              };
            }
          } else {
            // ìƒˆ í¬í† ìŠ¤íŒŸ ì¶”ê°€
            const newSpot = {
              ...data.spot,
              comments: [],
              liked: false
            };
            const spotIndex = spots.findIndex(s => s.id === editingSpotId);
            if (spotIndex !== -1) {
              spots[spotIndex] = newSpot;
            } else {
              spots.push(newSpot);
            }
          }
          
          renderSpots();
          document.getElementById('adminForm').style.display = 'none';
          editingSpotId = null;
        } else {
          alert(`âŒ ${data.error || 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}`);
        }
      } catch (error) {
        console.error('ì €ì¥ ì˜¤ë¥˜:', error);
        alert('âŒ ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    async function deleteSpot() {
      if(!editingSpotId) return;

      // ë¡œê·¸ì¸ í™•ì¸
      if (!authToken || !currentUser) {
        alert('âš ï¸ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        showLoginModal();
        return;
      }

      const spot = spots.find(s => s.id === editingSpotId);
      if(!spot) return;

      // ê¶Œí•œ í™•ì¸ (ê´€ë¦¬ìëŠ” ëª¨ë“  ìŠ¤íŒŸ ì‚­ì œ ê°€ëŠ¥)
      if (spot.authorId !== currentUser.id && !currentUser.isAdmin) {
        alert('âŒ ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë³¸ì¸ì´ ì‘ì„±í•œ í¬í† ìŠ¤íŒŸë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        return;
      }

      if(!confirm(`"${spot.name}"ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

      try {
        const response = await fetch(`${API_URL}/spots/${editingSpotId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${authToken}`
          }
        });

        const data = await response.json();

        if (response.ok) {
          alert(`âœ… "${spot.name}"ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!`);
          
          // ë¡œì»¬ spots ë°°ì—´ì—ì„œ í•´ë‹¹ í¬í† ìŠ¤íŒŸ ì œê±°
          const spotIndex = spots.findIndex(s => s.id === editingSpotId);
          if (spotIndex !== -1) {
            spots.splice(spotIndex, 1);
          }
          
          renderSpots();
          document.getElementById('adminForm').style.display = 'none';
          editingSpotId = null;
        } else {
          alert(`âŒ ${data.error || 'ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'}`);
        }
      } catch (error) {
        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
        alert('âŒ ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function addNewSpot() {
      // ë¡œê·¸ì¸ í™•ì¸
      if (!authToken || !currentUser) {
        alert('âš ï¸ í¬í† ìŠ¤íŒŸì„ ì¶”ê°€í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        showLoginModal();
        return;
      }

      const newId = 's' + Date.now(); // ì„ì‹œ ID
      const newSpot = {
        id: newId,
        name: 'ìƒˆ í¬í† ìŠ¤íŒŸ',
        desc: 'ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”',
        tags: [],
        lat: 37.5665,
        lng: 126.9780,
        img: 'https://images.unsplash.com/photo-1495995424756-f1a20e26bbca?w=600&h=400&fit=crop',
        comments: [],
        liked: false,
        likes: 0,
        province: '',
        city: '',
        district: '',
        detailAddress: '',
        address: '',
        placeName: '',
        mapImg: '',
        authorId: null, // ìƒˆ í¬í† ìŠ¤íŒŸì„ì„ í‘œì‹œ
        author: currentUser
      };

      spots.push(newSpot);
      
      editingSpotId = newId;
      loadSpotForEdit(newId);
      document.getElementById('adminForm').style.display = 'block';
      alert('âœ… ìƒˆ í¬í† ìŠ¤íŒŸì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì €ì¥í•˜ì„¸ìš”!');
    }

    function cancelEdit() {
      document.getElementById('adminForm').style.display = 'none';
      editingSpotId = null;
    }

    function extractMyData() {
      // localStorageì—ì„œ ì§ì ‘ ì¶”ì¶œ
      const localData = localStorage.getItem('photoSpots');
      if (!localData) {
        alert('âš ï¸ ì €ì¥ëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ë¨¼ì € ë°ì´í„°ë¥¼ ìˆ˜ì •í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      const blob = new Blob([localData], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ë‚´_í¬í† ìŠ¤íŒŸë°ì´í„°_${new Date().toISOString().replace(/[:.]/g, '-')}.json`;
      a.click();
      URL.revokeObjectURL(url);
      alert('âœ… ë‚´ ë°ì´í„°ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\níŒŒì¼ì„ ì €ì¥í•œ í›„ ê°œë°œìì—ê²Œ ì „ë‹¬í•´ì£¼ì„¸ìš”.');
    }

    function exportData() {
      const dataStr = JSON.stringify(spots, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `í¬í† ìŠ¤íŒŸë°ì´í„°_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      alert('âœ… ë°ì´í„°ê°€ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤!');
    }

    function importData(evt) {
      const file = evt.target.files && evt.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const json = JSON.parse(String(e.target.result));
          let importedSpots = [];
          if(Array.isArray(json)) {
            importedSpots = json;
          } else if(Array.isArray(json.spots)) {
            importedSpots = json.spots;
          } else if(Array.isArray(json.spotData)) {
            // êµ¬ë²„ì „ í˜¸í™˜: spotDataë¥¼ ìµœì†Œ í•„ë“œë§Œ ë®ì–´ì“°ê¸°
            importedSpots = spots.map(s => {
              const found = json.spotData.find(d => d.id === s.id);
              if(found) {
                return { ...s, comments: found.comments || [], liked: !!found.liked };
              }
              return s;
            });
          }

          if(importedSpots.length > 0) {
            // ì •ê·œí™”
            spots = importedSpots.map(s => ({
              id: s.id,
              name: s.name || '',
              desc: s.desc || '',
              tags: Array.isArray(s.tags) ? s.tags : (s.tags ? String(s.tags).split(',').map(t=>t.trim()).filter(Boolean) : []),
              lat: parseFloat(s.lat) || 0,
              lng: parseFloat(s.lng) || 0,
              img: s.img || '',
              comments: Array.isArray(s.comments) ? s.comments : [],
              liked: !!s.liked,
              likes: typeof s.likes === 'number' ? s.likes : 0,
              address: s.address || '',
              placeName: s.placeName || '',
              mapImg: s.mapImg || ''
            }));

            saveLocalData();
            initAdminForm();
            renderSpots();
            alert('âœ… JSON ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì €ì¥í–ˆìŠµë‹ˆë‹¤.');
          } else {
            alert('ê°€ì ¸ì˜¬ ë°ì´í„° í˜•ì‹ì„ ì¸ì‹í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (spots ë°°ì—´ ë˜ëŠ” spotData í•„ìš”)');
          }
        } catch(err) {
          console.error(err);
          alert('JSON íŒŒì‹±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì˜¬ë°”ë¥¸ íŒŒì¼ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.');
        } finally {
          evt.target.value = '';
        }
      };
      reader.readAsText(file);
    }

    function searchNaverPlace() {
      const q = (document.getElementById('placeQuery').value || '').trim();
      const resultsBox = document.getElementById('placeResults');
      if(!q) { resultsBox.style.display = 'none'; resultsBox.innerHTML = ''; return; }
      
      // ë„¤ì´ë²„ Geocode APIë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ê°„ë‹¨í•œ ì•ˆë‚´ í‘œì‹œ
      resultsBox.style.display = 'block';
      resultsBox.innerHTML = `
        <div style="padding:15px; background:#fff8e1; border-radius:6px;">
          <strong>ğŸ’¡ ì¥ì†Œ ê²€ìƒ‰ ë„ì›€ë§</strong><br>
          <small style="line-height:1.6; color:#666;">
          1. <a href="https://map.naver.com" target="_blank" style="color:#0066cc;">ë„¤ì´ë²„ ì§€ë„</a>ì—ì„œ "${q}" ê²€ìƒ‰<br>
          2. ì¥ì†Œ í´ë¦­ â†’ ì£¼ì†Œ ë³µì‚¬<br>
          3. ì¢Œí‘œê°€ í•„ìš”í•˜ë©´ URLì—ì„œ í™•ì¸ (ì˜ˆ: ?lng=126.xxx&lat=37.xxx)<br>
          4. ì•„ë˜ í•„ë“œì— ì§ì ‘ ì…ë ¥
          </small>
        </div>
      `;
    }

    function applyPlaceResult(lat, lng, address, placeName) {
      if(!editingSpotId) return;
      const spot = spots.find(s => s.id === editingSpotId);
      if(!spot) return;
      spot.address = address || '';
      spot.placeName = placeName || '';
      document.getElementById('editAddress').value = address || '';
      document.getElementById('editPlaceName').value = placeName || '';
      document.getElementById('placeResults').style.display = 'none';
      document.getElementById('placeResults').innerHTML = '';
    }

    // ì „ì—­ ë³€ìˆ˜ë¡œ ìˆ™ë°•ì—…ì†Œì™€ ë§›ì§‘ ë°ì´í„° ì €ì¥
    let allAccommodations = [];
    let allRestaurants = [];
    let showingAllAccommodations = false;
    let showingAllRestaurants = false;

    // ê·¼ì²˜ ìˆ™ë°•ì—…ì†Œ ê²€ìƒ‰
    async function searchNearbyAccommodations(spot) {
      const nearbySection = document.getElementById('nearbyAccommodations');
      const accommodationsList = document.getElementById('accommodationsList');
      const showMoreBtn = document.getElementById('showMoreAccommodations');
      
      // ì¢Œí‘œê°€ ì—†ìœ¼ë©´ ìˆ¨ê¹€
      if (!spot.lat || !spot.lng) {
        nearbySection.style.display = 'none';
        return;
      }

      nearbySection.style.display = 'block';
      accommodationsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #888;"><i class="fas fa-spinner fa-spin"></i> ê²€ìƒ‰ ì¤‘...</div>';
      showMoreBtn.style.display = 'none';
      showingAllAccommodations = false;

      try {
        // ì„œë²„ì—ì„œ ê·¼ì²˜ ìˆ™ë°•ì—…ì†Œ ê²€ìƒ‰
        const response = await fetch(`${API_BASE_URL}/api/nearby-accommodations?lat=${spot.lat}&lng=${spot.lng}&radius=2000`);
        
        if (!response.ok) {
          throw new Error('ê²€ìƒ‰ ì‹¤íŒ¨');
        }

        const data = await response.json();
        
        if (!data.accommodations || data.accommodations.length === 0) {
          accommodationsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #888;">ê·¼ì²˜ì— ìˆ™ë°•ì—…ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }

        allAccommodations = data.accommodations;
        renderAccommodations(false);

      } catch (error) {
        console.error('ìˆ™ë°•ì—…ì†Œ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
        accommodationsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #888;">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }

    // ìˆ™ë°•ì—…ì†Œ ë Œë”ë§
    function renderAccommodations(showAll) {
      const accommodationsList = document.getElementById('accommodationsList');
      const showMoreBtn = document.getElementById('showMoreAccommodations');
      
      const displayCount = showAll ? allAccommodations.length : 2;
      const itemsToShow = allAccommodations.slice(0, displayCount);
      
      accommodationsList.innerHTML = itemsToShow.map(acc => `
        <div class="accommodation-item" onclick="window.open('https://map.kakao.com/link/to/${encodeURIComponent(acc.name)},${acc.lat},${acc.lng}', '_blank')">
          <div>
            <span class="accommodation-category">${acc.category}</span>
            <div class="accommodation-name">${acc.name}</div>
          </div>
          <div class="accommodation-address">ğŸ“ ${acc.address}</div>
          <div class="accommodation-distance">ğŸ“ ${acc.distance}m</div>
          ${acc.phone ? `<div class="accommodation-phone">ğŸ“ ${acc.phone}</div>` : ''}
        </div>
      `).join('');

      // ë”ë³´ê¸° ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€
      if (allAccommodations.length > 2) {
        showMoreBtn.style.display = 'block';
        showMoreBtn.innerHTML = showAll 
          ? '<i class="fas fa-chevron-up"></i> ì ‘ê¸°' 
          : `<i class="fas fa-chevron-down"></i> ë”ë³´ê¸° (${allAccommodations.length - 2}ê°œ ë”)`;
        showMoreBtn.classList.toggle('expanded', showAll);
      } else {
        showMoreBtn.style.display = 'none';
      }
    }

    // ë”ë³´ê¸°/ì ‘ê¸° í† ê¸€
    function toggleShowMoreAccommodations() {
      showingAllAccommodations = !showingAllAccommodations;
      renderAccommodations(showingAllAccommodations);
    }

    // ê·¼ì²˜ ë§›ì§‘ ê²€ìƒ‰
    async function searchNearbyRestaurants(spot) {
      const nearbySection = document.getElementById('nearbyRestaurants');
      const restaurantsList = document.getElementById('restaurantsList');
      const showMoreBtn = document.getElementById('showMoreRestaurants');
      
      // ì¢Œí‘œê°€ ì—†ìœ¼ë©´ ìˆ¨ê¹€
      if (!spot.lat || !spot.lng) {
        nearbySection.style.display = 'none';
        return;
      }

      nearbySection.style.display = 'block';
      restaurantsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #888;"><i class="fas fa-spinner fa-spin"></i> ê²€ìƒ‰ ì¤‘...</div>';
      showMoreBtn.style.display = 'none';
      showingAllRestaurants = false;

      try {
        // ì„œë²„ì—ì„œ ê·¼ì²˜ ë§›ì§‘ ê²€ìƒ‰
        const response = await fetch(`${API_BASE_URL}/api/nearby-restaurants?lat=${spot.lat}&lng=${spot.lng}&radius=1500`);
        
        if (!response.ok) {
          throw new Error('ê²€ìƒ‰ ì‹¤íŒ¨');
        }

        const data = await response.json();
        
        if (!data.restaurants || data.restaurants.length === 0) {
          restaurantsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #888;">ê·¼ì²˜ì— ë§›ì§‘ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }

        allRestaurants = data.restaurants;
        renderRestaurants(false);

      } catch (error) {
        console.error('ë§›ì§‘ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
        restaurantsList.innerHTML = '<div style="text-align: center; padding: 20px; color: #888;">ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }

    // ë§›ì§‘ ë Œë”ë§
    function renderRestaurants(showAll) {
      const restaurantsList = document.getElementById('restaurantsList');
      const showMoreBtn = document.getElementById('showMoreRestaurants');
      
      const displayCount = showAll ? allRestaurants.length : 2;
      const itemsToShow = allRestaurants.slice(0, displayCount);
      
      restaurantsList.innerHTML = itemsToShow.map(rest => `
        <div class="accommodation-item" onclick="window.open('https://map.kakao.com/link/to/${encodeURIComponent(rest.name)},${rest.lat},${rest.lng}', '_blank')">
          <div>
            <span class="accommodation-category">${rest.category}</span>
            <div class="accommodation-name">${rest.name}</div>
          </div>
          <div class="accommodation-address">ğŸ“ ${rest.address}</div>
          <div class="accommodation-distance">ğŸ“ ${rest.distance}m</div>
          ${rest.phone ? `<div class="accommodation-phone">ğŸ“ ${rest.phone}</div>` : ''}
        </div>
      `).join('');

      // ë”ë³´ê¸° ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€
      if (allRestaurants.length > 2) {
        showMoreBtn.style.display = 'block';
        showMoreBtn.innerHTML = showAll 
          ? '<i class="fas fa-chevron-up"></i> ì ‘ê¸°' 
          : `<i class="fas fa-chevron-down"></i> ë”ë³´ê¸° (${allRestaurants.length - 2}ê°œ ë”)`;
        showMoreBtn.classList.toggle('expanded', showAll);
      } else {
        showMoreBtn.style.display = 'none';
      }
    }

    // ë”ë³´ê¸°/ì ‘ê¸° í† ê¸€
    function toggleShowMoreRestaurants() {
      showingAllRestaurants = !showingAllRestaurants;
      renderRestaurants(showingAllRestaurants);
    }

    // í˜ì´ì§€ ì´ˆê¸°í™”
    async function initApp() {
      await checkAuth();
      await loadSpotsFromServer();
      renderSpots();
      updateCityOptions();
      
      // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
      const editProvinceSelect = document.getElementById('editProvince');
      const inlineEditProvinceSelect = document.getElementById('inlineEditProvince');
      const filterProvinceSelect = document.getElementById('filterProvince');
      const filterCitySelect = document.getElementById('filterCity');
      const mapFilterProvinceSelect = document.getElementById('mapFilterProvince');
      const mapFilterCitySelect = document.getElementById('mapFilterCity');
      
      if (editProvinceSelect) {
        editProvinceSelect.addEventListener('change', updateEditCitySelect);
      }
      if (inlineEditProvinceSelect) {
        inlineEditProvinceSelect.addEventListener('change', updateInlineEditCitySelect);
      }
      if (filterProvinceSelect) {
        filterProvinceSelect.addEventListener('change', updateFilterCitySelect);
      }
      if (filterCitySelect) {
        filterCitySelect.addEventListener('change', applyFilters);
      }
    }

    initApp();
  </script>
</body>
</html>
